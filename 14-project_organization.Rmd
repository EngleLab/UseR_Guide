# Project Organization

## The Working Directory

In every R script you will 1) import a data set from a file on your computer, 2) do stuff to that data file, and 3) export eithrer a data file or an analysis output file.

You could use what are refered to as _absolute_ file paths to import and export files but this is not good practice. The reason is that the _absolute_ file path is specific to a particular computer. No one computer is going to have the same _absolute_ file path. An _absolute_ file path starts from the root directory on your computer and may look something like:

Mac:  `~/Users/jasontsukahara/Dropbox (GaTech)/My Work/Coding Projects/R/R-Tutorial`

Windows:  `C:\Users\jasontsukahara\Dropbox (GaTech)\My Work\Coding Projects\R\R-Tutorial`

__You do not want to write scripts that can only work on a specific computer!__ One of the great advantages to programming for data processing is reproducibility. You and your future self (and other researchers) can reproduce your exact same data processing steps. __If you use absolute file paths you are undermining the reproducibility of your scripts__.

__It is good practice__ to use _relative_ file paths instead. _Relative_ file paths start from a root directory, usually the projects root directory. So if you have all your files and folders related to a research study in a directory called `Cool Study` then a _relative_ file path to the Raw data files might look something like:

Absolute path to raw data files in `Cool Study`: 

`~/Users/jasontsukahara/Dropbox (GaTech)/My Work/Research Projects/Cool Study/Data Files/Raw Data`

Relative file path:

`Data Files/Raw Data`

You can see that with _relative_ file paths, only the internal organization of the project directory matters. This allows your script to be ran on different computeres, systems, and environments! 

You working directory can be specified in various ways. By default, if you open up __RStudio__ directly it will set the working directory to some default location such as your _User_ root directory. __This is not good__. 

If you open up __RStudio__ by directly opening an _R script file_ then it will set the working directory to the location of that file. This is better but still not ideal. 

### R Projects

[Visit this page](https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects) for more details on R Projects.

Essentially there are several ways to set a working directory but the __best way__ is through the use of __R Projects__.

Above, I mentioned that one of the most important elements to your script's environment is the working directory. R Projects ensure that your working directory is set correctly and is always the same every time you use that script. Basically an R Project allows you to open a fresh session of R that automatically sets the working directory to the directory where the R Project is saved. R Projects have the file extension `.Rproj`.

Go ahead and create an R Project for this tutorial. Navigate to File -> New Project... -> 

Choose _Existing Directory_ if you already created an "R Tutorial"" folder on your computer or _New Directory -> New Project_ if you have not. Create the R Project in the root folder of your R Tutorial. 
   
Now exit out of R Studio. Then open R Studio by opening the R Project file. You can evaluate what the working directory is by typing `getwd()` in the console.
   
In your R Scripts you can now simply use relative paths from the working directory. And it doesn't matter what folder, within "R Tutorial"", you save your R scripts to. 

As an exercise, save an R script to a folder within your "R Tutorial"" directory. R scripts have the extension, `.R`. Navigate to File -> New File -> R Script. Save the script file to `R Scripts/test.R`. Close out of RStudio and directly open the `test.R` file. Now evaluate the working directory by typing `getwd()` in the console. 

Oops... you see the working directory is no longer where the `.Rproj` file is saved. **As long as you open RStudio from the `.Rproj` file and not one of the script `.R` files** then your working directory will automatically be set correctly. While this is much better it is still not ideal. This is where the `here` package comes in handy.

### here::here()

This method is simple to use and is a great way to specify _relative_ paths. It will allow you to open RStudio using any of your `.R` script files and maintain the some _relative_ file path from your `.Rproj` file across every R Script.

First go ahead and install the `here` package, `install.packages("here")`.
   
For a passionate ode to the `here` package see: https://github.com/jennybc/here_here
   
Basically, when `here` is loaded, `library(here)`, it will search for one of two files to locate the start of the _relative_ file path. 1) a hidden `.here` file or 2) an `.Rproj` file. It will recursively keep going backwards in directories to locate a root directory that contains one of these files.
   
The `.here` file can be created by `set_here()`, but is unnecessary if you are using the **R Project** method.
   
What this allows is pretty cool. Let's say your working directory is "R Tutorial", which is the directory where your `.Rproj` file is saved. Even if you have an `.R` script saved in `"R Tutorial/R scripts/test.R"`, you can open a new fresh session of R by opening that script file (instead of the `.Rproj` file). If you load `library(here)` at the top of the `test.R` file then it will automatically set a _relative_ file path from `"R Tutorial"` since it will detect an `.Rproj` file in that directory. Then tomorrow maybe you want to work on a different `.R` script located somewhere else but still within this same project direcotry. Let's say it is located at `"R Tutorial/Data/something dumb/scripts/thisisascript.R"`. Again, you can open a new fresh session of R by opening this file **AND** still have the same _relative_ file path no matter what script you open, or if you open the `.Rproj` file.

_Note that this method is actually a little different from setting a working directory._ Therefore, you need to use the `here()` function from the `here` package when using relative file paths. To reference a relative file path you can use `here()`. For instance 
   
```{r eval=FALSE}
library(here)
here("Data", "somethingdumb", "scripts", "thisisascript.R")

# Or

here("Data/somethingdumb/scripts", "thisisascript.R")
```

Both of these refer to the same relative file path 

```{r eval = FALSE}
"Data/somethingdumb/scripts/thisisascript.R"
```

The general format for using `here()` for importing or outputing a file might look something like

```{r eval = FALSE}
library(here)

read_csv(here("Data/Raw Data", "import_filename.csv"))

write_csv(here("Data/Scored Data" "output_filename.csv"))
```


When using `here()` the start of the _relative_ file path will ALWAYS be where the `.Rproj` file is located. Now in ALL of your scripts you can just use the `here()` function whenever you need to specificy a _relative_ file path. 

### RStudio Sessions

Also related to working directories is the concept of RStudio Sessions. RStudio is an environment window for interacting with R. When you are using RStudio, you are not directly interacting with the actual installed R software on your computer. You are interacting with the R software on your computer through RStudio. 

It is possible to have multiple RStudio sessions open at a given time. And each RStudio session can be interacting with a different _instance_ of R. Each instance of R can have different __working directories__ and different __packages loaded__. 

_IF YOU ALREADY HAVE AN RSTUDIO SESSION OPEN FROM A DIFFERENT PROJECT OR ROOT DIRECTORY, JUST OPENING AN `.R` SCRIPT FILE RELATED TO A NEW OR DIFFERENT PROJECT IS NOT CREATING THE RIGHT ENVIRONMENT FOR THAT SCRIPT TO WORK._

__THEREFORE EACH TIME YOU OPEN FILES RELATED TO A NEW OR DIFFERENT PROJECT YOU SHOULD EITHER:__

1. __CLOSE OUT OF R STUDIO AND REOPEN IT BY OPENING A FILE IN THE THE NEW OR DIFFERENT PROJECT__

or 

2. __OPEN A DIFFERENT RSTUDIO SESSION BY DIRECTLY OPENING THE `.RPROJ` FILE__

This is one of the advantages to using RProjects. If you are prone to not closing out of windows or *tabs*, RProjects allow you to easily manage the environment of multiple projects opened at one time. 

Additionally, it is suggested to not open script files from your computer directory. Instead, open script files from the *File Panel* in the bottom right section of your RStudio Session. That way the script file opens in the correct RStudio Session associated with a particular project.

----

The idea of loaded packages and objects is much simpler than working directories. Basically you want each R Script's environment to be independent of other R scripts. An R Script should not depend on the packages loaded or objects and functions created in another R Script.

So if I create an object called `data` in one R Script, another R Script should not rely on the object `data` from that previous R Script. Similarly, if I load a package called `dplyr` in one R Script, I should load the `dplyr` package again in any subsequent R Scripts that require that package.

You certainly will be writing sripts that depend on each other (As you move from one data processing stage to the next), but the environment of one R Script should not depend on the environment of another R Script. To test if the environment for one R Script depends on other R Scripts, you can close out of RStudio after executing each script file, re-opening RStudio and executing another script file. If a script does not work in a new fresh session of RStudio, then that script is likely depending on the environment of other R Scripts.

----

## Loaded Packages

To make sure that the packages used in one R Script do not depend on the packages loaded in other R Scripts:

__Load all required packages for that one R Script at the top of the script__

This allows you to easily evaluate which packages are required for that script. 

## Objects

To make sure that the objects and functions created in one R Script do not depend on the objects and functions created in other R Scripts:

__Include the following line of code at the bottome of the script__

`rm(list=ls())`

This will remove any objects and functions in the current environment. That way when the next R Script is ran, there will be no leftover objects or functions from previous R Scripts.

********

```{r echo=FALSE, message=FALSE, warning=FALSE}
rm(list=ls())
```

********

**Something**

