<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>R Tutorial for the EngleLab</title>
  <meta name="description" content="This is a short R Tutorial for the EngleLab">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="R Tutorial for the EngleLab" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a short R Tutorial for the EngleLab" />
  <meta name="github-repo" content="EngleLab" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R Tutorial for the EngleLab" />
  
  <meta name="twitter:description" content="This is a short R Tutorial for the EngleLab" />
  

<meta name="author" content="Jason Tsukahara">


<meta name="date" content="2018-12-12">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="organization-and-good-practices.html">
<link rel="next" href="analyzing-data-in-r.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>1</b> Installation</a><ul>
<li class="chapter" data-level="1.1" data-path="installation.html"><a href="installation.html#installing-r"><i class="fa fa-check"></i><b>1.1</b> Installing R</a></li>
<li class="chapter" data-level="1.2" data-path="installation.html"><a href="installation.html#installing-r-studio"><i class="fa fa-check"></i><b>1.2</b> Installing R Studio</a></li>
<li class="chapter" data-level="1.3" data-path="installation.html"><a href="installation.html#the-r-studio-environemnt"><i class="fa fa-check"></i><b>1.3</b> The R Studio Environemnt</a></li>
<li class="chapter" data-level="1.4" data-path="installation.html"><a href="installation.html#r-studio-settings"><i class="fa fa-check"></i><b>1.4</b> R Studio Settings</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="basic-r.html"><a href="basic-r.html"><i class="fa fa-check"></i><b>2</b> Basic R</a><ul>
<li class="chapter" data-level="2.1" data-path="basic-r.html"><a href="basic-r.html#creating-r-objects"><i class="fa fa-check"></i><b>2.1</b> Creating R objects</a><ul>
<li class="chapter" data-level="2.1.1" data-path="basic-r.html"><a href="basic-r.html#classes"><i class="fa fa-check"></i><b>2.1.1</b> Classes</a></li>
<li class="chapter" data-level="2.1.2" data-path="basic-r.html"><a href="basic-r.html#vectors"><i class="fa fa-check"></i><b>2.1.2</b> Vectors</a></li>
<li class="chapter" data-level="2.1.3" data-path="basic-r.html"><a href="basic-r.html#factors"><i class="fa fa-check"></i><b>2.1.3</b> Factors</a></li>
<li class="chapter" data-level="2.1.4" data-path="basic-r.html"><a href="basic-r.html#lists"><i class="fa fa-check"></i><b>2.1.4</b> Lists</a></li>
<li class="chapter" data-level="2.1.5" data-path="basic-r.html"><a href="basic-r.html#data-frames"><i class="fa fa-check"></i><b>2.1.5</b> Data Frames</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="basic-r.html"><a href="basic-r.html#ifthen-statements"><i class="fa fa-check"></i><b>2.2</b> If…then Statements</a></li>
<li class="chapter" data-level="2.3" data-path="basic-r.html"><a href="basic-r.html#r-packages"><i class="fa fa-check"></i><b>2.3</b> R Packages</a><ul>
<li class="chapter" data-level="2.3.1" data-path="basic-r.html"><a href="basic-r.html#installing-and-loading-r-packages"><i class="fa fa-check"></i><b>2.3.1</b> Installing and Loading R Packages</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="basic-r.html"><a href="basic-r.html#more-r-basic-resources"><i class="fa fa-check"></i><b>2.4</b> More R Basic Resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="intermediate-r.html"><a href="intermediate-r.html"><i class="fa fa-check"></i><b>3</b> Intermediate R</a><ul>
<li class="chapter" data-level="3.1" data-path="intermediate-r.html"><a href="intermediate-r.html#for-loops"><i class="fa fa-check"></i><b>3.1</b> For Loops</a></li>
<li class="chapter" data-level="3.2" data-path="intermediate-r.html"><a href="intermediate-r.html#functions"><i class="fa fa-check"></i><b>3.2</b> Functions</a><ul>
<li class="chapter" data-level="3.2.1" data-path="intermediate-r.html"><a href="intermediate-r.html#creating-your-own-functions"><i class="fa fa-check"></i><b>3.2.1</b> Creating Your Own Functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>4</b> Workflow</a></li>
<li class="chapter" data-level="5" data-path="the-tidyverse.html"><a href="the-tidyverse.html"><i class="fa fa-check"></i><b>5</b> The tidyverse</a><ul>
<li class="chapter" data-level="5.1" data-path="the-tidyverse.html"><a href="the-tidyverse.html#readr---import"><i class="fa fa-check"></i><b>5.1</b> readr - import</a></li>
<li class="chapter" data-level="5.2" data-path="the-tidyverse.html"><a href="the-tidyverse.html#dplyr"><i class="fa fa-check"></i><b>5.2</b> dplyr</a><ul>
<li class="chapter" data-level="5.2.1" data-path="the-tidyverse.html"><a href="the-tidyverse.html#rename"><i class="fa fa-check"></i><b>5.2.1</b> <code>rename()</code></a></li>
<li class="chapter" data-level="5.2.2" data-path="the-tidyverse.html"><a href="the-tidyverse.html#filter"><i class="fa fa-check"></i><b>5.2.2</b> <code>filter()</code></a></li>
<li class="chapter" data-level="5.2.3" data-path="the-tidyverse.html"><a href="the-tidyverse.html#select"><i class="fa fa-check"></i><b>5.2.3</b> <code>select()</code></a></li>
<li class="chapter" data-level="5.2.4" data-path="the-tidyverse.html"><a href="the-tidyverse.html#mutate"><i class="fa fa-check"></i><b>5.2.4</b> <code>mutate()</code></a></li>
<li class="chapter" data-level="5.2.5" data-path="the-tidyverse.html"><a href="the-tidyverse.html#group_by"><i class="fa fa-check"></i><b>5.2.5</b> <code>group_by()</code></a></li>
<li class="chapter" data-level="5.2.6" data-path="the-tidyverse.html"><a href="the-tidyverse.html#summarise"><i class="fa fa-check"></i><b>5.2.6</b> <code>summarise()</code></a></li>
<li class="chapter" data-level="5.2.7" data-path="the-tidyverse.html"><a href="the-tidyverse.html#spread"><i class="fa fa-check"></i><b>5.2.7</b> <code>spread()</code></a></li>
<li class="chapter" data-level="5.2.8" data-path="the-tidyverse.html"><a href="the-tidyverse.html#pipe-operator"><i class="fa fa-check"></i><b>5.2.8</b> Pipe Operator %&gt;%</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="the-tidyverse.html"><a href="the-tidyverse.html#readr---export"><i class="fa fa-check"></i><b>5.3</b> readr - export</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="transformations.html"><a href="transformations.html"><i class="fa fa-check"></i><b>6</b> Transformations</a><ul>
<li class="chapter" data-level="6.1" data-path="transformations.html"><a href="transformations.html#descriptive-statistics"><i class="fa fa-check"></i><b>6.1</b> Descriptive Statistics</a></li>
<li class="chapter" data-level="6.2" data-path="transformations.html"><a href="transformations.html#centering-and-standardizing-variables"><i class="fa fa-check"></i><b>6.2</b> Centering and Standardizing Variables</a></li>
<li class="chapter" data-level="6.3" data-path="transformations.html"><a href="transformations.html#transformations-1"><i class="fa fa-check"></i><b>6.3</b> Transformations</a><ul>
<li class="chapter" data-level="6.3.1" data-path="transformations.html"><a href="transformations.html#log"><i class="fa fa-check"></i><b>6.3.1</b> log</a></li>
<li class="chapter" data-level="6.3.2" data-path="transformations.html"><a href="transformations.html#polynomial"><i class="fa fa-check"></i><b>6.3.2</b> polynomial</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="transformations.html"><a href="transformations.html#composites"><i class="fa fa-check"></i><b>6.4</b> Composites</a></li>
<li class="chapter" data-level="6.5" data-path="transformations.html"><a href="transformations.html#custom-transformations"><i class="fa fa-check"></i><b>6.5</b> Custom Transformations</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="englelab-packages.html"><a href="englelab-packages.html"><i class="fa fa-check"></i><b>7</b> EngleLab Packages</a><ul>
<li class="chapter" data-level="7.1" data-path="englelab-packages.html"><a href="englelab-packages.html#englelab"><i class="fa fa-check"></i><b>7.1</b> englelab</a><ul>
<li class="chapter" data-level="7.1.1" data-path="englelab-packages.html"><a href="englelab-packages.html#tidy-raw-data-functions"><i class="fa fa-check"></i><b>7.1.1</b> “tidy” raw data functions</a></li>
<li class="chapter" data-level="7.1.2" data-path="englelab-packages.html"><a href="englelab-packages.html#score-data-functions"><i class="fa fa-check"></i><b>7.1.2</b> score data functions</a></li>
<li class="chapter" data-level="7.1.3" data-path="englelab-packages.html"><a href="englelab-packages.html#calculating-bin-scores"><i class="fa fa-check"></i><b>7.1.3</b> Calculating Bin Scores</a></li>
<li class="chapter" data-level="7.1.4" data-path="englelab-packages.html"><a href="englelab-packages.html#reliability-functions"><i class="fa fa-check"></i><b>7.1.4</b> Reliability functions</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="englelab-packages.html"><a href="englelab-packages.html#datawrangling"><i class="fa fa-check"></i><b>7.2</b> datawrangling</a><ul>
<li class="chapter" data-level="7.2.1" data-path="englelab-packages.html"><a href="englelab-packages.html#merging-data-files"><i class="fa fa-check"></i><b>7.2.1</b> Merging Data Files</a></li>
<li class="chapter" data-level="7.2.2" data-path="englelab-packages.html"><a href="englelab-packages.html#reshpaing-data"><i class="fa fa-check"></i><b>7.2.2</b> Reshpaing Data</a></li>
<li class="chapter" data-level="7.2.3" data-path="englelab-packages.html"><a href="englelab-packages.html#transformations-2"><i class="fa fa-check"></i><b>7.2.3</b> Transformations</a></li>
<li class="chapter" data-level="7.2.4" data-path="englelab-packages.html"><a href="englelab-packages.html#data-cleaning"><i class="fa fa-check"></i><b>7.2.4</b> Data Cleaning</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="organization-and-good-practices.html"><a href="organization-and-good-practices.html"><i class="fa fa-check"></i><b>8</b> Organization and Good Practices</a><ul>
<li class="chapter" data-level="8.1" data-path="organization-and-good-practices.html"><a href="organization-and-good-practices.html#r-scripts"><i class="fa fa-check"></i><b>8.1</b> R Scripts</a><ul>
<li class="chapter" data-level="8.1.1" data-path="organization-and-good-practices.html"><a href="organization-and-good-practices.html#general-workflow"><i class="fa fa-check"></i><b>8.1.1</b> General Workflow</a></li>
<li class="chapter" data-level="8.1.2" data-path="organization-and-good-practices.html"><a href="organization-and-good-practices.html#building-a-template-workflow"><i class="fa fa-check"></i><b>8.1.2</b> Building a Template Workflow</a></li>
<li class="chapter" data-level="8.1.3" data-path="organization-and-good-practices.html"><a href="organization-and-good-practices.html#rmlistls"><i class="fa fa-check"></i><b>8.1.3</b> rm(list=ls())</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="organization-and-good-practices.html"><a href="organization-and-good-practices.html#working-directory"><i class="fa fa-check"></i><b>8.2</b> Working Directory</a><ul>
<li class="chapter" data-level="8.2.1" data-path="organization-and-good-practices.html"><a href="organization-and-good-practices.html#r-projects"><i class="fa fa-check"></i><b>8.2.1</b> R Projects</a></li>
<li class="chapter" data-level="8.2.2" data-path="organization-and-good-practices.html"><a href="organization-and-good-practices.html#here"><i class="fa fa-check"></i><b>8.2.2</b> here()</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="organization-and-good-practices.html"><a href="organization-and-good-practices.html#the-masterscript"><i class="fa fa-check"></i><b>8.3</b> The masterscript</a></li>
<li class="chapter" data-level="8.4" data-path="organization-and-good-practices.html"><a href="organization-and-good-practices.html#folder-organization"><i class="fa fa-check"></i><b>8.4</b> Folder Organization</a></li>
<li class="chapter" data-level="8.5" data-path="organization-and-good-practices.html"><a href="organization-and-good-practices.html#naming-r-scripts"><i class="fa fa-check"></i><b>8.5</b> Naming R Scripts</a></li>
<li class="chapter" data-level="8.6" data-path="organization-and-good-practices.html"><a href="organization-and-good-practices.html#summary"><i class="fa fa-check"></i><b>8.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="example-data-preparation.html"><a href="example-data-preparation.html"><i class="fa fa-check"></i><b>9</b> Example: Data Preparation</a><ul>
<li class="chapter" data-level="9.1" data-path="example-data-preparation.html"><a href="example-data-preparation.html#initial-setup"><i class="fa fa-check"></i><b>9.1</b> Initial Setup</a><ul>
<li class="chapter" data-level="9.1.1" data-path="example-data-preparation.html"><a href="example-data-preparation.html#set-up-directory-structure"><i class="fa fa-check"></i><b>9.1.1</b> Set up directory structure</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="example-data-preparation.html"><a href="example-data-preparation.html#masterscript"><i class="fa fa-check"></i><b>9.2</b> Masterscript</a></li>
<li class="chapter" data-level="9.3" data-path="example-data-preparation.html"><a href="example-data-preparation.html#creating-messy-merged-file"><i class="fa fa-check"></i><b>9.3</b> Creating “messy” Merged File</a><ul>
<li class="chapter" data-level="9.3.1" data-path="example-data-preparation.html"><a href="example-data-preparation.html#e-prime-2.0"><i class="fa fa-check"></i><b>9.3.1</b> E-Prime 2.0</a></li>
<li class="chapter" data-level="9.3.2" data-path="example-data-preparation.html"><a href="example-data-preparation.html#skipping-e-merge-with-e-prime-3.0"><i class="fa fa-check"></i><b>9.3.2</b> Skipping E-Merge with E-Prime 3.0</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="example-data-preparation.html"><a href="example-data-preparation.html#step-1-messy-to-tidy"><i class="fa fa-check"></i><b>9.4</b> Step 1: “messy” to “tidy”</a><ul>
<li class="chapter" data-level="9.4.1" data-path="example-data-preparation.html"><a href="example-data-preparation.html#what-to-include"><i class="fa fa-check"></i><b>9.4.1</b> What to Include</a></li>
<li class="chapter" data-level="9.4.2" data-path="example-data-preparation.html"><a href="example-data-preparation.html#import-messy-data"><i class="fa fa-check"></i><b>9.4.2</b> Import “messy” data</a></li>
<li class="chapter" data-level="9.4.3" data-path="example-data-preparation.html"><a href="example-data-preparation.html#remove-duplicate-subjects"><i class="fa fa-check"></i><b>9.4.3</b> Remove Duplicate Subjects</a></li>
<li class="chapter" data-level="9.4.4" data-path="example-data-preparation.html"><a href="example-data-preparation.html#filter-rows"><i class="fa fa-check"></i><b>9.4.4</b> Filter Rows</a></li>
<li class="chapter" data-level="9.4.5" data-path="example-data-preparation.html"><a href="example-data-preparation.html#rename-variables"><i class="fa fa-check"></i><b>9.4.5</b> Rename Variables</a></li>
<li class="chapter" data-level="9.4.6" data-path="example-data-preparation.html"><a href="example-data-preparation.html#rename-values"><i class="fa fa-check"></i><b>9.4.6</b> Rename Values</a></li>
<li class="chapter" data-level="9.4.7" data-path="example-data-preparation.html"><a href="example-data-preparation.html#select-columns"><i class="fa fa-check"></i><b>9.4.7</b> Select Columns</a></li>
<li class="chapter" data-level="9.4.8" data-path="example-data-preparation.html"><a href="example-data-preparation.html#save-to-file"><i class="fa fa-check"></i><b>9.4.8</b> Save to File</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="example-data-preparation.html"><a href="example-data-preparation.html#step-2-raw-tidy-to-scored"><i class="fa fa-check"></i><b>9.5</b> Step 2: raw “tidy” to scored</a><ul>
<li class="chapter" data-level="9.5.1" data-path="example-data-preparation.html"><a href="example-data-preparation.html#set-up"><i class="fa fa-check"></i><b>9.5.1</b> Set up</a></li>
<li class="chapter" data-level="9.5.2" data-path="example-data-preparation.html"><a href="example-data-preparation.html#import"><i class="fa fa-check"></i><b>9.5.2</b> Import</a></li>
<li class="chapter" data-level="9.5.3" data-path="example-data-preparation.html"><a href="example-data-preparation.html#data-cleaning-1"><i class="fa fa-check"></i><b>9.5.3</b> Data Cleaning</a></li>
<li class="chapter" data-level="9.5.4" data-path="example-data-preparation.html"><a href="example-data-preparation.html#calculate-flankereffect-on-rt-and-accuracy"><i class="fa fa-check"></i><b>9.5.4</b> Calculate FlankerEffect on RT and Accuracy</a></li>
<li class="chapter" data-level="9.5.5" data-path="example-data-preparation.html"><a href="example-data-preparation.html#remove-subjects"><i class="fa fa-check"></i><b>9.5.5</b> Remove Subjects</a></li>
<li class="chapter" data-level="9.5.6" data-path="example-data-preparation.html"><a href="example-data-preparation.html#calculate-binned-scores"><i class="fa fa-check"></i><b>9.5.6</b> Calculate Binned Scores</a></li>
<li class="chapter" data-level="9.5.7" data-path="example-data-preparation.html"><a href="example-data-preparation.html#save-data-file"><i class="fa fa-check"></i><b>9.5.7</b> Save data file</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="example-data-preparation.html"><a href="example-data-preparation.html#source-in-masterscript"><i class="fa fa-check"></i><b>9.6</b> <code>source()</code> in Masterscript</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="analyzing-data-in-r.html"><a href="analyzing-data-in-r.html"><i class="fa fa-check"></i><b>10</b> Analyzing Data in R</a><ul>
<li class="chapter" data-level="10.1" data-path="analyzing-data-in-r.html"><a href="analyzing-data-in-r.html#r-markdown"><i class="fa fa-check"></i><b>10.1</b> R Markdown</a><ul>
<li class="chapter" data-level="10.1.1" data-path="analyzing-data-in-r.html"><a href="analyzing-data-in-r.html#yaml-header"><i class="fa fa-check"></i><b>10.1.1</b> YAML header</a></li>
<li class="chapter" data-level="10.1.2" data-path="analyzing-data-in-r.html"><a href="analyzing-data-in-r.html#r-code-chunks"><i class="fa fa-check"></i><b>10.1.2</b> R code chunks</a></li>
<li class="chapter" data-level="10.1.3" data-path="analyzing-data-in-r.html"><a href="analyzing-data-in-r.html#formatted-text"><i class="fa fa-check"></i><b>10.1.3</b> Formatted text</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Tutorial for the EngleLab</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="example-data-preparation" class="section level1">
<h1><span class="header-section-number">Chapter 9</span> Example: Data Preparation</h1>
<p><img src="images/workflow.png" width="1276" /></p>
<p>Chapters 5 through 8 should have provided you all you need to know in order to start writing scripts to get your data ready for statistical analysis. The data preparation steps include <strong>1)</strong> converting “messy” raw data to “tidy” raw data and <strong>2)</strong> creating data file with task scores that have gone through data cleaning.</p>
<p>Based on the information from Chapters 5 through 8. <strong>This Chapter</strong> will go over step-by-step how to create R scripts to do data preparation using an example data set from the Flanker task.</p>
<p>You can download this example data set here</p>
<p><a href="http://englelab.gatech.edu/R/example_data/Flanker_Example.zip">Download Example Flanker Data</a></p>
<hr />
<div id="initial-setup" class="section level2">
<h2><span class="header-section-number">9.1</span> Initial Setup</h2>
<div id="set-up-directory-structure" class="section level3">
<h3><span class="header-section-number">9.1.1</span> Set up directory structure</h3>
<p>First let’s setup our directory organization. In the directory where your .Rproj file is located, you should create the following folders:</p>
<ul>
<li><p><strong>R Scripts</strong> - A folder to put all your scripts in one place</p></li>
<li><p><strong>Data Files</strong> - A folder where any data files will be stored</p></li>
<li><p><strong>Results</strong> - A folder where any outputed results and figures will be stored</p></li>
</ul>
<p>When conducting a study you might have other directores such as “Tasks” where the task files are located, or “Methods” where any methods documents or materials are located.</p>
<p>The <strong>Results</strong> directory will become relevant later when we get into performing statistical analyses on data.</p>
<p>Within the <strong>Data Files</strong> directory you should create the following folders:</p>
<ul>
<li><p><strong>Raw Data</strong> - A folder containing raw data files</p></li>
<li><p><strong>Scored Data</strong> - A folder containig scored data files</p></li>
</ul>
<p>Within the <strong>Raw Data</strong> folder you should create the following directory</p>
<ul>
<li><strong>E-Merge</strong> - A folder containing E-Merged and exported .txt merged files</li>
</ul>
<p>This structure helps to keep clear where we are importing and outputing data files to in the data workflow process.</p>
<ul>
<li><p>The “messy” raw data files are located in the <strong>E-Merge</strong> folder.</p></li>
<li><p>The “tidy” raw data files are located in the <strong>Raw Data</strong> folder.</p></li>
<li><p>The scored task files are located in the <strong>Scored Data</strong> folder.</p></li>
</ul>
<p>Our R Scripts should be able to completely (100%) recreate ALL files in the <strong>Raw Data</strong> and <strong>Scored Data</strong> files based on what is in the <strong>E-Merge</strong> folder.</p>
<p>Unzip the Example Flanker data to the <strong>E-Merge</strong> folder.</p>
<p>One of the files is an E-Merged file, the other is the E-Merged file exported to a tab-delimited .txt file. There is also a folder labled <strong>subj</strong>.</p>
<p>We will come back to what these files are later.</p>
</div>
</div>
<div id="masterscript" class="section level2">
<h2><span class="header-section-number">9.2</span> Masterscript</h2>
<p>In Chapter 8, you saw an example masterscript. Lets’ go over how to begin creating one.</p>
<p>First open a new script window <strong>File -&gt; New File -&gt; R Script</strong></p>
<p>Save the script as “masterscript_RTutorial.R” to where your .Rproj file is located (the home directory).</p>
<p>Alternatively you might prefer to save the script as “0_masterscript_RTutorial.R” in the <strong>R Scripts</strong> folder. The reason for the 0 will become evident later.</p>
<p>At the top of every script I like to have a “Setup” section where I load packages, set import and output directories, and set any other important variables.</p>
<p>In the masterscript I like to create a list object that contains the directory structure we created above. And then save that directory tree as an R object (.rds) to the home directory.</p>
<p>What this allows is for each script that we are going to create to access the same directory tree by importing the directory tree R object file (.rds). It will not be apparent to you now, but this will save a lot of time when you have many R scripts.</p>
<p>For instance: If the folder names have changed, you will not have to update the file paths in each R script, rather you can just do it from the masterscript. Also, if you want to copy and paste the same scripts to use in a different study (that used the same tasks) then, again, you do not have to update each R script to reflect the different folder names for that study. You can just update the masterscript.</p>
<p>This allows you to foucs on writing and executing the scripts rather than wasting time on getting the file path names perfect across every script.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Setup ####
<span class="kw">library</span>(here)

## Set the directory tree
directories &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">scripts =</span> <span class="st">&quot;R Scripts&quot;</span>,
                    <span class="dt">data =</span> <span class="st">&quot;Data Files&quot;</span>,
                    <span class="dt">raw =</span> <span class="st">&quot;Data Files/Raw Data&quot;</span>,
                    <span class="dt">messy =</span> <span class="st">&quot;Data Files/Raw Data/E-Merge&quot;</span>,
                    <span class="dt">scored =</span> <span class="st">&quot;Data Files/Scored Data&quot;</span>,
                    <span class="dt">results =</span> <span class="st">&quot;Results&quot;</span>)

<span class="kw">saveRDS</span>(directories, <span class="kw">here</span>(<span class="st">&quot;directories.rds&quot;</span>))
#############</code></pre></div>
<p>Now if we want to access the <strong>E-Merge</strong> folder path in an R Script we could do so by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">directories &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">here</span>(<span class="st">&quot;directories.rds&quot;</span>))

directories<span class="op">$</span>messy
## [1] &quot;Data Files/Raw Data/E-Merge&quot;</code></pre></div>
<p>For now we are done with the masterscript. We will come back later and add lines of code to run the scripts you will create in these examples.</p>
<p>Go ahead and source the masterscript to create the directories object file.</p>
<hr />
<p><br><br></p>
<hr />
</div>
<div id="creating-messy-merged-file" class="section level2">
<h2><span class="header-section-number">9.3</span> Creating “messy” Merged File</h2>
<p>Before performing the data preparation procedures, you will need to create a “messy” raw data file that is a merge of the individual subject files.</p>
<ul>
<li><p>If the data files were created with E-Prime 2.0 you HAVE to do this using the E-Merge software program.</p></li>
<li><p>If the data files were created with E-Prime 3.0 AND the option to export as .txt is enabled, then you have to choice to by-pass the E-Merge software program and perform the merge in R instead,</p></li>
</ul>
<div id="e-prime-2.0" class="section level3">
<h3><span class="header-section-number">9.3.1</span> E-Prime 2.0</h3>
<p>Individual subject data files created from tasks in E-Prime 2.0, HAVE to be merged together by</p>
<ol style="list-style-type: decimal">
<li><p>Creatingt an E-Merged file using the E-Merge software.</p></li>
<li><p>Exporting that E-Merged file to a .txt file.</p></li>
</ol>
<p>I’ve already done these two steps for you.</p>
</div>
<div id="skipping-e-merge-with-e-prime-3.0" class="section level3">
<h3><span class="header-section-number">9.3.2</span> Skipping E-Merge with E-Prime 3.0</h3>
<p>Altenratively, in E-Prime 3.0 we have the option to skip over these two steps completely. In E-Prime 3.0 there is the option to output a .txt version of the .edat file that is created when a subject finishes a task. This means we will be able to directly import the individual subject data files into R without going through E-Prime software.</p>
<p>The <strong>subj</strong> folder, in the zip folder you downloaded, contains individual subject .edat files exported as a .txt file. We will cover how to merge these individual files into one Merged file.</p>
<p>Create a new script and save it as “._study_finish.txt&quot; in the <strong>R Scripts</strong> folder. The purpose of this script is to get to a single Merged file for all subject. This is a step that is typically only done once or as few times as possible. Because of this will not put it into the masterscript and we do not assign the script name a number (use “.” in place).</p>
<p>First create the setup section at the top of the script. We will need the following packages; <code>here</code>, <code>datawrangling</code>, and <code>readr</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Setup ####
<span class="kw">library</span>(here)
<span class="kw">library</span>(datawrangling)
<span class="kw">library</span>(readr)

## Set import and output directories
directories &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">here</span>(<span class="st">&quot;directories.rds&quot;</span>))
import.dir &lt;-<span class="st"> </span><span class="kw">paste</span>(directories<span class="op">$</span>messy, <span class="st">&quot;subj&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>)
output.dir &lt;-<span class="st"> </span>directories<span class="op">$</span>messy

## Set import and output file names
output.file &lt;-<span class="st"> &quot;Flanker.txt&quot;</span>
#############</code></pre></div>
<p>We will use the <code>files_bind()</code> function from the <code>datawrangling</code> package to stack each subject file ontop of one another.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Merge data files
<span class="kw">files_bind</span>(<span class="dt">path =</span> <span class="kw">here</span>(import.dir), <span class="dt">pattern =</span> <span class="st">&quot;Flanker&quot;</span>, <span class="dt">output.file =</span> <span class="kw">here</span>(output.dir, output.file))</code></pre></div>
<p>This should do it. So your entire script should look something like</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Setup ####
<span class="kw">library</span>(here)
<span class="kw">library</span>(datawrangling)
<span class="kw">library</span>(readr)

## Set import and output directories
directories &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">here</span>(<span class="st">&quot;directories.rds&quot;</span>))
import.dir &lt;-<span class="st"> </span><span class="kw">paste</span>(directories<span class="op">$</span>messy, <span class="st">&quot;subj&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>)
output.dir &lt;-<span class="st"> </span>directories<span class="op">$</span>messy
#############

## Merge data files
<span class="kw">files_bind</span>(<span class="dt">path =</span> <span class="kw">here</span>(import.dir), <span class="dt">pattern =</span> <span class="st">&quot;Flanker&quot;</span>, <span class="dt">output.file =</span> <span class="kw">here</span>(output.dir, output.file))

<span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())</code></pre></div>
<p>Source and save your script.</p>
<hr />
<p><br><br></p>
<hr />
</div>
</div>
<div id="step-1-messy-to-tidy" class="section level2">
<h2><span class="header-section-number">9.4</span> Step 1: “messy” to “tidy”</h2>
<p>The first step in the data preparation procedure is to creat a “tidy” raw data file from the “messy” raw data file.</p>
<div id="what-to-include" class="section level3">
<h3><span class="header-section-number">9.4.1</span> What to Include</h3>
<p>Creating a “tidy” raw data file is essentialy a process of elimination. Getting rid of columns and rows that have no value. You may also want to rename columns and values.</p>
<p><strong>So what should you keep?</strong></p>
<p>You want to keep all <strong>columns</strong> that are essential to the design of the task. This might include a column that specifies the condition for each trial, a column that specifies a feature of the target stimulus, performance variables, and more.</p>
<p>As for <strong>rows</strong>, I suggest keeping both practice and real trials. It is easy to filter out practice trials later. The “tidy” raw data file should contain only one row per trial per subject.</p>
<p>You should probably <strong>rename variables and values</strong> to be easy for those unfamiliar with how the task was programmed to understand. Also if you have similar tasks (<em>Flanker</em> and <em>Stroop</em>) it is probably a good idea to give similar names to variables and values. For instance, give the same name to the column that contains the condition type. Also use the same value names for each condition (not <em>congruent</em> for one task, and <em>cong</em> for another). Use a standard name for columns with reaction time and accuracy values (RT, Accuracy).</p>
</div>
<div id="import-messy-data" class="section level3">
<h3><span class="header-section-number">9.4.2</span> Import “messy” data</h3>
<p>Open a new script file and save it to the <strong>R Scripts</strong> folder as “1_flanker_raw”</p>
<p>The “1” denotes that this is the first step in our workflow process; converting “messy” raw data files to “tidy” raw data files.</p>
<p>Again, create the setup section at the top</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Setup ####
<span class="kw">library</span>(here)
<span class="kw">library</span>(readr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(datawrangling)

## Set import and output directories
directories &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">here</span>(<span class="st">&quot;directories.rds&quot;</span>))
import.dir &lt;-<span class="st"> </span>directories<span class="op">$</span>messy
output.dir &lt;-<span class="st"> </span>directories<span class="op">$</span>raw

## Set import and output file names
import.file &lt;-<span class="st"> &quot;Flanker.txt&quot;</span>
output.file &lt;-<span class="st"> &quot;Flanker_raw.txt&quot;</span>
#############</code></pre></div>
<p>Okay, first thing is to import the “messy” merged .txt data file. To do this use the <code>read_delim</code> function from the <code>readr</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Import
import &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="kw">here</span>(import.dir, import.file), <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">escape_double =</span> <span class="ot">FALSE</span>, <span class="dt">trim_ws =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>You can then view the data file with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(import)</code></pre></div>
<p>It is a mess, right? Here are some things you need to know about the “messy” raw data file. These are the columns and what type of values they contain:</p>
<hr />
<p><strong>Subject</strong>: Subject number</p>
<p><strong>Procedure[Trial]</strong>: Procedure type (keep: TrialProc and PracTrialProc)</p>
<p><strong>PracTrialList.Sample</strong>: Trial number for practice trials</p>
<p><strong>TrialList.Sample</strong>: Trial number for real trials</p>
<p><strong>FlankerType</strong>: condition for real and practice trials (Values are: congruent, incongruent, and neutral)</p>
<p><strong>PracSlideTarget.RT</strong>: Reaction time for practice trials</p>
<p><strong>PracSlideTarget.ACC</strong>: Accuracy for practice trials</p>
<p><strong>PracSlideTarget.RESP</strong>: Response for practice trials ({LEFTARROW} = left and {RIGHTARROW} = right)</p>
<p><strong>SlideTarget.RT</strong>: Reaction time for real trials</p>
<p><strong>SlideTarget.ACC</strong>: Accuracy for real trials</p>
<p><strong>SlideTarget.RESP</strong>: Response for real trials ({LEFTARROW} = left and {RIGHTARROW} = right)</p>
<p><strong>TargerDirection</strong>: direction of the target arrow for practice trials</p>
<p><strong>TargetDirection</strong>: direction of the target arrow for real trials</p>
<p><strong>SessionDate</strong>: Date of session</p>
<p><strong>SessionTime</strong>: Time of session</p>
<hr />
</div>
<div id="remove-duplicate-subjects" class="section level3">
<h3><span class="header-section-number">9.4.3</span> Remove Duplicate Subjects</h3>
<p>Now it happens on occasion that the wrong subject number is entered in when an RA is starting up a task. This can result in duplicate Subject numbers in the E-Merge file. Luckily I have created a function to remove the duplicate subjects, and put their information (with session date and time) into a specific file. This file will be created in a new folder called “duplicates”.</p>
<p>The function is <code>duplicates_remove()</code> from the <code>datawrangling</code> package on my GitHub.</p>
<p>It can be difficult to remember what arguments you need to include in a function. To see helpful documentation about a function you can type in the console</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(datawrangling)
?duplicates_remove</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Import
import &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="kw">here</span>(import.dir, import.file), <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">escape_double =</span> <span class="ot">FALSE</span>, <span class="dt">trim_ws =</span> <span class="ot">TRUE</span>)
import &lt;-<span class="st"> </span><span class="kw">duplicates_remove</span>(import, <span class="dt">taskname =</span> <span class="st">&quot;Flanker&quot;</span>, <span class="dt">output.folder =</span> <span class="kw">here</span>(output.dir))</code></pre></div>
</div>
<div id="filter-rows" class="section level3">
<h3><span class="header-section-number">9.4.4</span> Filter Rows</h3>
<p>Filter only relevant rows. We want to keep only the rows that contain trials from the practice and real trials. To do this we use the <code>filter()</code> function of the <code>dplyr</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Tidy
data_flanker &lt;-<span class="st"> </span>import <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;TrialProc&quot;</span> <span class="op">|</span><span class="st"> `</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;PracTrialProc&quot;</span>)</code></pre></div>
<p>The column names are contained in single quotes because the names contain the special characters <code>[ ]</code>. There are certain characters R does not like to use as variable names and one of them is square brackets.</p>
</div>
<div id="rename-variables" class="section level3">
<h3><span class="header-section-number">9.4.5</span> Rename Variables</h3>
<p>Now the column specifying real vs practice trials is a little tedious to keep typing out since it requires the single quotes and brackets. We will also want to rename this column to be more coherent in the final “tidy” data format anyways. To rename columns we can use <code>rename()</code> function in <code>dplyr</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Tidy
data_flanker &lt;-<span class="st"> </span>import <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;TrialProc&quot;</span> <span class="op">|</span><span class="st"> `</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;PracTrialProc&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">TrialProc =</span> <span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span>)</code></pre></div>
</div>
<div id="rename-values" class="section level3">
<h3><span class="header-section-number">9.4.6</span> Rename Values</h3>
<p>Let’s change the values in <code>TrialProc</code>. Right now real trials have the value of “TrialProc”. The same name as the column, not good! And the “practice” trials have the value of “PractTrialProc”. Let’s simply change these values to “real” and “practice”, respectively.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Tidy
data_flanker &lt;-<span class="st"> </span>import <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;TrialProc&quot;</span> <span class="op">|</span><span class="st"> `</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;PracTrialProc&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">TrialProc =</span> <span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">TrialProc =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;TrialProc&quot;</span>, <span class="st">&quot;real&quot;</span>, <span class="st">&quot;practice&quot;</span>))</code></pre></div>
<p>Note that we are not being very specific with <code>ifelse()</code>. Rows that do not equal <code>&quot;TrialProc&quot;</code> get set as <code>&quot;practice&quot;</code>. This is okay ONLY because we already applied a filter to only include rows with the value <code>&quot;TrialProc&quot;</code> or with the value <code>&quot;PracTrialProc&quot;</code>. If we did not apply this filter, or if there were more than two values for the column <code>TrialProc</code>, then rows that were not <code>&quot;PracTrialProc&quot;</code> would get set to <code>&quot;practice&quot;</code> as well.</p>
<p>The point is, be careful how you are using <code>ifelse()</code>.</p>
<p>An alternative to <code>ifelse()</code> that I like is the <code>case_when()</code> function from <code>dplyr</code>. You can be more specific with <code>case_when()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Tidy
data_flanker &lt;-<span class="st"> </span>import <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;TrialProc&quot;</span> <span class="op">|</span><span class="st"> `</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;PracTrialProc&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">TrialProc =</span> <span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">TrialProc =</span> <span class="kw">case_when</span>(TrialProc<span class="op">==</span><span class="st">&quot;TrialProc&quot;</span> <span class="op">~</span><span class="st"> &quot;real&quot;</span>,
                               TrialProc<span class="op">==</span><span class="st">&quot;PracTrialProc&quot;</span> <span class="op">~</span><span class="st"> &quot;practice&quot;</span>,
                               <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.character</span>(<span class="ot">NA</span>)))</code></pre></div>
<p>In <code>case_when()</code> you still specify a logical argument <code>TrialProc==&quot;TrialProc&quot;</code> and you set what should happen when that argument is TRUE by using the <code>~</code> symbol. So, cases when <code>TrialProc==&quot;TrialProc&quot;</code> set <code>~</code> value to <code>&quot;real&quot;</code>. At the End of <code>case_when()</code> you need to specify what should happen if none of those cases specified above are TRUE. You do this by typing <code>TRUE ~</code> followed by what to do. Usually you will want to set the value to missing. The tricky thing here is that <code>NA</code> is a logical value. A column of values can only be of one type (e.g. a column cannot contain both logical and character values). To get around this we just set <code>NA</code> to whatever value the column should take <code>as.character(NA)</code>.</p>
<hr />
<p>Okay now let’s move on to figuring out what other columns we want to keep and if we need to do any more computations on them.</p>
<p>We want to keep the columns that specify the following information</p>
<ul>
<li>Subject number</li>
<li>TrialProc (real vs practice)</li>
<li>Trial number</li>
<li>Condition (congruent vs incongruent)</li>
<li>Reaction time</li>
<li>Accuracy</li>
<li>Response</li>
<li>Target arrow direction (left or right)</li>
<li>Session Date</li>
<li>Session Time</li>
</ul>
<p>This gets a little more tricky here because the information for some of these variables are in one column for practice trials and a different column for real trials. That means we need to merge the information from these two columns into one. We can do this using the<code>mutate()</code> function from the <code>dplyr</code> package.</p>
<p>For instance the RT data for practice trials is contained in the column <code>PracSlideTarget.RT</code> and for real trials RT data is in <code>SlideTarget.RT</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Tidy
data_flanker &lt;-<span class="st"> </span>import <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;TrialProc&quot;</span> <span class="op">|</span><span class="st"> `</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;PracTrialProc&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">TrialProc =</span> <span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">TrialProc =</span> <span class="kw">case_when</span>(TrialProc<span class="op">==</span><span class="st">&quot;TrialProc&quot;</span> <span class="op">~</span><span class="st"> &quot;real&quot;</span>,
                               TrialProc<span class="op">==</span><span class="st">&quot;PracTrialProc&quot;</span> <span class="op">~</span><span class="st"> &quot;practice&quot;</span>,
                               <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.character</span>(<span class="ot">NA</span>)),
         <span class="dt">RT =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, SlideTarget.RT, PracSlideTarget.RT))</code></pre></div>
<p>So the new column RT gets set to the value that is contained in SlideTarget.RT if it is a real trial, if not then the RT gets a value contained in PracSlideTarget.RT</p>
<p>We can do the same thing for trial, accuracy, response, and target arrow direction. Combining them all into one <code>mutate()</code> function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Tidy
data_flanker &lt;-<span class="st"> </span>import <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;TrialProc&quot;</span> <span class="op">|</span><span class="st"> `</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;PracTrialProc&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">TrialProc =</span> <span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">TrialProc =</span> <span class="kw">case_when</span>(TrialProc<span class="op">==</span><span class="st">&quot;TrialProc&quot;</span> <span class="op">~</span><span class="st"> &quot;real&quot;</span>,
                               TrialProc<span class="op">==</span><span class="st">&quot;PracTrialProc&quot;</span> <span class="op">~</span><span class="st"> &quot;practice&quot;</span>,
                               <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.character</span>(<span class="ot">NA</span>)),
         <span class="dt">RT =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, SlideTarget.RT, PracSlideTarget.RT),
         <span class="dt">Accuracy =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, SlideTarget.ACC, PracSlideTarget.ACC),
         <span class="dt">TargetArrowDirection =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, TargetDirection, TargerDirection),
         <span class="dt">Response =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, SlideTarget.RESP, PracSlideTarget.RESP))</code></pre></div>
<p>You might want to change the values in the Response and CorrectResponse columns to be more clear (left and right).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Tidy
data_flanker &lt;-<span class="st"> </span>import <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;TrialProc&quot;</span> <span class="op">|</span><span class="st"> `</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;PracTrialProc&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">TrialProc =</span> <span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">TrialProc =</span> <span class="kw">case_when</span>(TrialProc<span class="op">==</span><span class="st">&quot;TrialProc&quot;</span> <span class="op">~</span><span class="st"> &quot;real&quot;</span>,
                               TrialProc<span class="op">==</span><span class="st">&quot;PracTrialProc&quot;</span> <span class="op">~</span><span class="st"> &quot;practice&quot;</span>,
                               <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.character</span>(<span class="ot">NA</span>)),
         <span class="dt">RT =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, SlideTarget.RT, PracSlideTarget.RT),
         <span class="dt">Accuracy =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, SlideTarget.ACC, PracSlideTarget.ACC),
         <span class="dt">TargetArrowDirection =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, TargetDirection, TargerDirection),
         <span class="dt">Response =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, SlideTarget.RESP, PracSlideTarget.RESP),
         <span class="dt">Response =</span> <span class="kw">ifelse</span>(Response<span class="op">==</span><span class="st">&quot;{LEFTARROW}&quot;</span>, <span class="st">&quot;left&quot;</span>, <span class="kw">ifelse</span>(Response<span class="op">==</span><span class="st">&quot;{RIGHTARROW}&quot;</span>, <span class="st">&quot;right&quot;</span>, <span class="ot">NA</span>)))</code></pre></div>
<p>Notice how I included an <code>ifelse()</code> function inside of an <code>ifelse()</code> function. The inner <code>ifelse()</code> will occur if <code>Response</code> does not equal <code>&quot;{LEFTARROW}&quot;</code>. This is another way to be more specific when using <code>ifelse()</code> instead of <code>case_when()</code>. It is up to you which you prefer to use.</p>
<p>You have to be careful with <code>ifelse()</code> statements because sometimes it does something you do not expect it to. <strong>That is why it is always important to check to make sure your code is performing as you want it to.</strong> View the dataframe to make sure everything is good. The new columns will be added at the end of the dataframe.</p>
</div>
<div id="select-columns" class="section level3">
<h3><span class="header-section-number">9.4.7</span> Select Columns</h3>
<p>We are getting closer to a “tidy” raw data file. The only thing left is to select the columns we want to keep. We do this by using the <code>select()</code> function from the <code>dplyr</code> package.</p>
<p>Remember we want to only select columns with the following information</p>
<ul>
<li>Subject number</li>
<li>Trial number</li>
<li>Condition</li>
<li>Reaction time</li>
<li>Accuracy</li>
<li>Response</li>
<li>Correct Response</li>
<li>Target arrow direction</li>
<li>Session Date</li>
<li>Session Time</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Tidy
data_flanker &lt;-<span class="st"> </span>import <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;TrialProc&quot;</span> <span class="op">|</span><span class="st"> `</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;PracTrialProc&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">TrialProc =</span> <span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">TrialProc =</span> <span class="kw">case_when</span>(TrialProc<span class="op">==</span><span class="st">&quot;TrialProc&quot;</span> <span class="op">~</span><span class="st"> &quot;real&quot;</span>,
                               TrialProc<span class="op">==</span><span class="st">&quot;PracTrialProc&quot;</span> <span class="op">~</span><span class="st"> &quot;practice&quot;</span>,
                               <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.character</span>(<span class="ot">NA</span>)),
         <span class="dt">RT =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, SlideTarget.RT, PracSlideTarget.RT),
         <span class="dt">Accuracy =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, SlideTarget.ACC, PracSlideTarget.ACC),
         <span class="dt">TargetArrowDirection =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, TargetDirection, TargerDirection),
         <span class="dt">Response =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, SlideTarget.RESP, PracSlideTarget.RESP),
         <span class="dt">Response =</span> <span class="kw">ifelse</span>(Response<span class="op">==</span><span class="st">&quot;{LEFTARROW}&quot;</span>, <span class="st">&quot;left&quot;</span>, <span class="kw">ifelse</span>(Response<span class="op">==</span><span class="st">&quot;{RIGHTARROW}&quot;</span>, <span class="st">&quot;right&quot;</span>, <span class="ot">NA</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Subject, TrialProc, Trial, <span class="dt">Condition =</span> FlankerType, RT, Accuracy, Response, TargetArrowDirection, SessionDate, SessionTime)</code></pre></div>
</div>
<div id="save-to-file" class="section level3">
<h3><span class="header-section-number">9.4.8</span> Save to File</h3>
<p>The function of an R script is to import a dataframe -&gt; transform or analyze the dataframe -&gt; output a final product (a new dataframe or analysis output). The objects which an R script creates (which you can see in the <strong>Environemnt</strong> window) are not the final end point. These are just temporary objects that are used to go from an input -&gt; output.</p>
<p>You have done the importing and transforming; now you need to output the final product - which is a saved .txt file of the “tidy” raw data.</p>
<p>To save the dataframe to a .txt file you will use the <code>write_delim()</code> function of the <code>readr</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Save
<span class="kw">write_delim</span>(data_flanker, <span class="dt">path =</span> <span class="kw">here</span>(output.dir, output.file), <span class="dt">delim =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">na =</span> <span class="st">&quot;&quot;</span>)</code></pre></div>
<hr />
<p>Then if we were to put it all together, using the template from the previous chapter:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Setup ####
<span class="kw">library</span>(here)
<span class="kw">library</span>(readr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(datawrangling)

## Set import and output directories
directories &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">here</span>(<span class="st">&quot;directories.rds&quot;</span>))
import.dir &lt;-<span class="st"> </span>directories<span class="op">$</span>messy
output.dir &lt;-<span class="st"> </span>directories<span class="op">$</span>raw

## Set import and output file names
import.file &lt;-<span class="st"> &quot;Flanker.txt&quot;</span>
output.file &lt;-<span class="st"> &quot;Flanker_raw.txt&quot;</span>
#############

## Import
import &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="kw">here</span>(import.dir, import.file), <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">escape_double =</span> <span class="ot">FALSE</span>, <span class="dt">trim_ws =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">duplicates_remove</span>(<span class="dt">taskname =</span> <span class="st">&quot;Flanker&quot;</span>, <span class="dt">output.folder =</span> <span class="kw">here</span>(output.dir))

## Tidy
data_flanker &lt;-<span class="st"> </span>import <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;TrialProc&quot;</span> <span class="op">|</span><span class="st"> `</span><span class="dt">Procedure[Trial]</span><span class="st">`</span><span class="op">==</span><span class="st">&quot;PracTrialProc&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">TrialProc =</span> <span class="st">`</span><span class="dt">Procedure[Trial]</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">TrialProc =</span> <span class="kw">case_when</span>(TrialProc<span class="op">==</span><span class="st">&quot;TrialProc&quot;</span> <span class="op">~</span><span class="st"> &quot;real&quot;</span>,
                               TrialProc<span class="op">==</span><span class="st">&quot;PracTrialProc&quot;</span> <span class="op">~</span><span class="st"> &quot;practice&quot;</span>,
                               <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.character</span>(<span class="ot">NA</span>)),
         <span class="dt">RT =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, SlideTarget.RT, PracSlideTarget.RT),
         <span class="dt">Accuracy =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, SlideTarget.ACC, PracSlideTarget.ACC),
         <span class="dt">TargetArrowDirection =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, TargetDirection, TargerDirection),
         <span class="dt">Response =</span> <span class="kw">ifelse</span>(TrialProc<span class="op">==</span><span class="st">&quot;real&quot;</span>, SlideTarget.RESP, PracSlideTarget.RESP),
         <span class="dt">Response =</span> <span class="kw">ifelse</span>(Response<span class="op">==</span><span class="st">&quot;{LEFTARROW}&quot;</span>, <span class="st">&quot;left&quot;</span>, <span class="kw">ifelse</span>(Response<span class="op">==</span><span class="st">&quot;{RIGHTARROW}&quot;</span>, <span class="st">&quot;right&quot;</span>, <span class="ot">NA</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Subject, TrialProc, Trial, <span class="dt">Condition =</span> FlankerType, RT, Accuracy, Response, TargetArrowDirection, SessionDate, SessionTime)

## Save
<span class="kw">write_delim</span>(data_flanker, <span class="dt">path =</span> <span class="kw">here</span>(output.dir, output.file), <span class="dt">delim =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">na =</span> <span class="st">&quot;&quot;</span>)

<span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())</code></pre></div>
<p>Great! You have written an R script for the first step in Data Preparation, converting a “messy” raw data file to a “tidy” raw data file.</p>
<hr />
<p><br></p>
<hr />
</div>
</div>
<div id="step-2-raw-tidy-to-scored" class="section level2">
<h2><span class="header-section-number">9.5</span> Step 2: raw “tidy” to scored</h2>
<p>Next we will go over how to write an R script for the second step - which involves <strong>data cleaning and task scoring</strong>.</p>
<p>This step is more complicated and often times requires some forethought. But we don’t always have the best forethought so you will likely re-write previous lines of code.</p>
<p>One thing you must think about before writing the script for this stage is the statistical analyses you eventually plan on conducting. This is because the final resulting dataframe will depend on what analyses you do. The data structure required for conducting a between-subject mean comparison will be different from the data structure required for a within-subject mean comparison or regression. The type of statistical analyses you plan on conducting will determine the final dataframe you want to end up at in this stage of data preparation.</p>
<p>Another thing you must think about before hand are the final dependent variables (or task scores) you want to calaculate. For instance, in the Flanker task there are several task scores we might want to calculate (in a regression context).</p>
<ul>
<li><p><strong>FlankerEffect on RT</strong>: Mean reaction time difference between incongruent and congruent trials</p></li>
<li><p><strong>FlankerEffect on Accuracy</strong>: Mean accuracy difference between incongruent and congruent trials</p></li>
<li><p><strong>Flanker Binned Scores</strong>: A scoring method to combine accuracy and reaction time (an alternative to difference scores)</p></li>
</ul>
<p>Finally, you should also think about what sort of data cleaning procedures you want to use. For instance, maybe you only want to calculate the FlankerEffect on RT for accurate trials and not innaccurate trials. Or perhaps you want to remove trials that are less than 200ms (too fast of responding to reflect cognitive processing).</p>
<hr />
<p>First start by opening a new script file and saving it to the <strong>R Scripts</strong> folder as “2_flanker_score”</p>
<div id="set-up" class="section level3">
<h3><span class="header-section-number">9.5.1</span> Set up</h3>
<p>Create the Setup section of the R script. In addition to the import and output directories we will set the data cleaning paramters as well.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Setup ####
<span class="kw">library</span>(here)
<span class="kw">library</span>(readr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(datawrangling)
<span class="kw">library</span>(englelab)

## Set import and output directories
directories &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">here</span>(<span class="st">&quot;directories.rds&quot;</span>))
import.dir &lt;-<span class="st"> </span>directories<span class="op">$</span>raw
output.dir &lt;-<span class="st"> </span>directories<span class="op">$</span>scored

## Set import and output files
import.file &lt;-<span class="st"> &quot;Flanker_raw.txt&quot;</span>
output.file &lt;-<span class="st"> &quot;Flanker_Scores.txt&quot;</span>
#############</code></pre></div>
<p>Import directory is the <strong>Raw Data</strong> folder where the “tidy” raw file is located. The output directory is the <strong>Scored Data</strong> folder.</p>
</div>
<div id="import" class="section level3">
<h3><span class="header-section-number">9.5.2</span> Import</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Import ####
import &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="kw">here</span>(import.dir, import.file), <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">escape_double =</span> <span class="ot">FALSE</span>, <span class="dt">trim_ws =</span> <span class="ot">TRUE</span>)
##############</code></pre></div>
</div>
<div id="data-cleaning-1" class="section level3">
<h3><span class="header-section-number">9.5.3</span> Data Cleaning</h3>
<p>In the example we are about to go through we will implement the following data cleaning procedures when calculating the three scores listed above. They will be implemented in the following order</p>
<ol style="list-style-type: decimal">
<li><p>Set RTs less than 200ms to missing (<code>NA</code>)</p></li>
<li><p>Trim RTs. Replace Outlier RTs that are above or below <strong>3.5 SDs</strong> of the mean, with values exactly at <strong>3.5 SDs</strong> above or below the mean. This is evaluated for each Subject by each condition seprately.</p></li>
<li><p>Finally remove subjects that on any Trial condition (congruent, incongruent, neutral) performed less than <strong>3.5 standard deviations</strong> below the mean on that condition.</p></li>
</ol>
<p>First we need to get rid of <strong>practice trials</strong> / keep only <strong>real trials</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Trim RTs ####
data_trim &lt;-<span class="st"> </span>import <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(TrialProc <span class="op">==</span><span class="st"> &quot;real&quot;</span>)
#################</code></pre></div>
<p>Then,</p>
<ol style="list-style-type: decimal">
<li>set RTs less than 200ms to missing (<code>NA</code>) using <code>mutate()</code></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Trim RTs ####
data_trim &lt;-<span class="st"> </span>import <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(TrialProc <span class="op">==</span><span class="st"> &quot;real&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">RT =</span> <span class="kw">ifelse</span>(RT <span class="op">&lt;</span><span class="st"> </span><span class="dv">200</span>, <span class="ot">NA</span>, RT))
#################</code></pre></div>
<p>And,</p>
<ol start="2" style="list-style-type: decimal">
<li>Trim RTs, grouped by <strong>Subject</strong> and <strong>Condition</strong> using the <code>trim()</code> function from the <code>datawrangling</code> package.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Trim RTs ####
data_trim &lt;-<span class="st"> </span>import <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(TrialProc <span class="op">==</span><span class="st"> &quot;real&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">RT =</span> <span class="kw">ifelse</span>(RT <span class="op">&lt;</span><span class="st"> </span><span class="dv">200</span>, <span class="ot">NA</span>, RT)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Subject, Condition) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">trim</span>(<span class="dt">variables =</span> <span class="st">&quot;RT&quot;</span>, <span class="dt">cutoff =</span> <span class="fl">3.5</span>, <span class="dt">replace =</span> <span class="st">&quot;cutoff&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>()
#################</code></pre></div>
<p><strong>Always be sure to <code>ungroup()</code> aftewards.</strong></p>
<p>Note the <code>replace</code> argument in <code>trim()</code>. Outliers are being replaced with the value at 3.5 SDs of the mean (the cutoff value). Outliers can also be replaced with the <code>&quot;mean&quot;</code>, <code>&quot;median&quot;</code>, or <code>&quot;NA&quot;</code>.</p>
<p>We will implement the third data cleaning procedure later.</p>
</div>
<div id="calculate-flankereffect-on-rt-and-accuracy" class="section level3">
<h3><span class="header-section-number">9.5.4</span> Calculate FlankerEffect on RT and Accuracy</h3>
<p>The general strategy we will take is to create two different dataframes. 1) <code>data_flanker</code> in which we calculate the FlankerEffect on RT and Accuracy and 2) <code>data_binned</code> in which we calculate the Flanker Binned scores. Then we will merge the two dataframes together.</p>
<div id="calculate-mean-rts-and-mean-accuracy" class="section level4">
<h4><span class="header-section-number">9.5.4.1</span> Calculate Mean RTs and Mean Accuracy</h4>
<p>We will want to calculate the Flanker Effect on RT for accurate trials only. So let’s set RTs on innacurate trials to <code>NA</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Calculate FlankerEffect on RT and Accuracy ####
data_flanker &lt;-<span class="st"> </span>data_trim <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">RT =</span> <span class="kw">ifelse</span>(Accuracy<span class="op">==</span><span class="dv">0</span>, <span class="ot">NA</span>, RT))
##################################################</code></pre></div>
<p>Now we can calculate mean RTs and Accuracy for each condition per subject using <code>group_by()</code> and <code>summarise()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Calculate FlankerEffect on RT and Accuracy ####
data_flanker &lt;-<span class="st"> </span>data_trim <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">RT =</span> <span class="kw">ifelse</span>(Accuracy<span class="op">==</span><span class="dv">0</span>, <span class="ot">NA</span>, RT)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Subject, Condition) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">RT.mean =</span> <span class="kw">mean</span>(RT, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
            <span class="dt">Accuracy.mean =</span> <span class="kw">mean</span>(Accuracy, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>()
##################################################</code></pre></div>
<p>Be sure to <code>ungroup()</code> when you are done with it!</p>
<p>And then spread “RT” and “Accuracy” across conditions. Creating columns for mean RT and mean Accuracy for each separate condition.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Calculate FlankerEffect on RT and Accuracy ####
data_flanker &lt;-<span class="st"> </span>data_trim <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">RT =</span> <span class="kw">ifelse</span>(Accuracy<span class="op">==</span><span class="dv">0</span>, <span class="ot">NA</span>, RT)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Subject, Condition) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">RT.mean =</span> <span class="kw">mean</span>(RT, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
            <span class="dt">Accuracy.mean =</span> <span class="kw">mean</span>(Accuracy, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">reshape_spread</span>(<span class="dt">variables =</span> <span class="st">&quot;Condition&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;RT.mean&quot;</span>, <span class="st">&quot;Accuracy.mean&quot;</span>), <span class="dt">id =</span> <span class="st">&quot;Subject&quot;</span>)
##################################################</code></pre></div>
<p>Now the dataframe is setup to calculate Flanker Effects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Calculate FlankerEffect on RT and Accuracy ####
data_flanker &lt;-<span class="st"> </span>data_trim <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">RT =</span> <span class="kw">ifelse</span>(Accuracy<span class="op">==</span><span class="dv">0</span>, <span class="ot">NA</span>, RT)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Subject, Condition) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">RT.mean =</span> <span class="kw">mean</span>(RT, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
            <span class="dt">Accuracy.mean =</span> <span class="kw">mean</span>(Accuracy, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">reshape_spread</span>(<span class="dt">variables =</span> <span class="st">&quot;Condition&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;RT.mean&quot;</span>, <span class="st">&quot;Accuracy.mean&quot;</span>), <span class="dt">id =</span> <span class="st">&quot;Subject&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">FlankerEffect_RT =</span> incongruent_RT.mean <span class="op">-</span><span class="st"> </span>congruent_RT.mean,
         <span class="dt">FlankerEffect_ACC =</span> incongruent_Accuracy.mean <span class="op">-</span><span class="st"> </span>congruent_Accuracy.mean)
##################################################</code></pre></div>
</div>
</div>
<div id="remove-subjects" class="section level3">
<h3><span class="header-section-number">9.5.5</span> Remove Subjects</h3>
<p>The approach I like to take with entirely removing subjects is to keep a record of those subjects in a data file somewhere. To do this we will 1) create a new dataframe of subjects that will be removed and then 2) use a function I created, <code>remove_save()</code> from the <code>datawrangling</code> package. This function is a short hand way of doing two things at once.</p>
<ol style="list-style-type: decimal">
<li><p>Removing the subjects from the full data file</p></li>
<li><p>Saving the removed subjects to a specified directory.</p></li>
</ol>
<p>The criteria we are removing subjects based on are those who performed 3.5 SDs below the mean. So we first need to calaculate a column of z-scores (on SD units), then filter those who are below 3.5 z-scores.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Remove poor performing subjects ####
data_remove &lt;-<span class="st"> </span>data_flanker <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">center</span>(<span class="dt">variables =</span> <span class="kw">c</span>(<span class="st">&quot;congruent_Accuracy.mean&quot;</span>, 
                       <span class="st">&quot;incongruent_Accuracy.mean&quot;</span>, 
                       <span class="st">&quot;neutral_Accuracy.mean&quot;</span>), 
         <span class="dt">standardize =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(congruent_Accuracy.mean_z <span class="op">&lt;</span><span class="st"> </span>(<span class="op">-</span><span class="fl">3.5</span>) <span class="op">|</span>
<span class="st">           </span>incongruent_Accuracy.mean_z <span class="op">&lt;</span><span class="st"> </span>(<span class="op">-</span><span class="fl">3.5</span>) <span class="op">|</span><span class="st"> </span>
<span class="st">           </span>neutral_Accuracy.mean_z <span class="op">&lt;</span><span class="st"> </span>(<span class="op">-</span><span class="fl">3.5</span>))</code></pre></div>
<p>Then use <code>remove_save()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_flanker &lt;-<span class="st"> </span><span class="kw">remove_save</span>(data_flanker, data_remove, 
                            <span class="dt">output.dir =</span> <span class="kw">here</span>(output.dir, <span class="st">&quot;removed&quot;</span>), 
                            <span class="dt">output.file =</span> <span class="st">&quot;Flanker_removed.txt&quot;</span>)
#######################################</code></pre></div>
<p>The first argument is the full data frame (<code>data_flanker</code>) and the second argument is the dataframe that contains the subjects to be removed (<code>data_remove</code>). You should now see a folder called <strong>removed</strong> in the <strong>Scored Data</strong> folder with a file called “Flanker_removed.txt”.</p>
</div>
<div id="calculate-binned-scores" class="section level3">
<h3><span class="header-section-number">9.5.6</span> Calculate Binned Scores</h3>
<p>Great! We have now calculated FlankerEffects scores and perfomred the data cleaning procedures. Now we need to calculate Binned scores. The <code>data_flanker</code> dataframe is no longer in a formate that we can calculate bin scores. We need to the trimmed dataframe that has trial level data.</p>
<p>We should remove the poor performing subjects and Missing RTs. <strong>This step is actually really important for the binning procedure because bin scores are relative to other subjects in the data.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Calculate Binned scores ####
data_binned &lt;-<span class="st"> </span>data_trim <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(RT), <span class="op">!</span>(Subject <span class="op">%in%</span><span class="st"> </span>data_remove<span class="op">$</span>Subject))
###############################</code></pre></div>
<p>We also need to remove neutral trials to calculate bin scores. Bin scores are based on comparing one condition to a baseline condition. In this case we want to compare the incongruent condition to the baseline congruent condition. So we need to get rid of neutral conditions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Calculate Binned scores ####
data_binned &lt;-<span class="st"> </span>data_trim <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(RT), <span class="op">!</span>(Subject <span class="op">%in%</span><span class="st"> </span>data_remove<span class="op">$</span>Subject), Condition <span class="op">!=</span><span class="st"> &quot;neutral&quot;</span>)
###############################</code></pre></div>
<p>And finally calculate bin scores using <code>bin_score()</code> from the <code>englelab</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Calculate Binned scores ####
data_binned &lt;-<span class="st"> </span>data_trim <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(RT), <span class="op">!</span>(Subject <span class="op">%in%</span><span class="st"> </span>data_remove<span class="op">$</span>Subject), Condition <span class="op">!=</span><span class="st"> &quot;neutral&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bin_score</span>(<span class="dt">rt.col =</span> <span class="st">&quot;RT&quot;</span>, <span class="dt">accuracy.col =</span> <span class="st">&quot;Accuracy&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;mean&quot;</span>,
            <span class="dt">condition.col =</span> <span class="st">&quot;Condition&quot;</span>, <span class="dt">baseline.condition =</span> <span class="st">&quot;congruent&quot;</span>, <span class="dt">id =</span> <span class="st">&quot;Subject&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">FlankerBin =</span> <span class="st">&quot;BinScore&quot;</span>)
###############################</code></pre></div>
<p>Awesome! Now we have two dataframes, one, <code>data_flanker</code>, with FlankerEffect scores and another, <code>data_binned</code> with FlankerBin scores. They both have one row per subject. Now we can merge these two dataframes together using the <code>merge()</code> function from base R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Merge dataframes and save ####
data_flanker &lt;-<span class="st"> </span><span class="kw">merge</span>(data_flanker, data_binned, <span class="dt">by =</span> <span class="st">&quot;Subject&quot;</span>, <span class="dt">all =</span> <span class="ot">TRUE</span>)
#################################</code></pre></div>
</div>
<div id="save-data-file" class="section level3">
<h3><span class="header-section-number">9.5.7</span> Save data file</h3>
<p>And finally save the datafile</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Merge dataframes and save ####
data_flanker &lt;-<span class="st"> </span><span class="kw">merge</span>(data_flanker, data_binned, <span class="dt">by =</span> <span class="st">&quot;Subject&quot;</span>, <span class="dt">all =</span> <span class="ot">TRUE</span>)
<span class="kw">write_delim</span>(data_flanker, <span class="dt">path =</span> <span class="kw">here</span>(output.dir, output.file), <span class="dt">delim =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">na =</span> <span class="st">&quot;&quot;</span>)
#################################</code></pre></div>
<p>If we put it all together your R script should look something like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Setup ####
<span class="kw">library</span>(here)
<span class="kw">library</span>(readr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(datawrangling)
<span class="kw">library</span>(englelab)

## Set import and output directories
directories &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">here</span>(<span class="st">&quot;directories.rds&quot;</span>))
import.dir &lt;-<span class="st"> </span>directories<span class="op">$</span>raw
output.dir &lt;-<span class="st"> </span>directories<span class="op">$</span>scored

## Set import and output files
import.file &lt;-<span class="st"> &quot;Flanker_raw.txt&quot;</span>
output.file &lt;-<span class="st"> &quot;Flanker_Scores.txt&quot;</span>
#############

## Import ####
import &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="kw">here</span>(import.dir, <span class="st">&quot;Flanker_raw.txt&quot;</span>), <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">escape_double =</span> <span class="ot">FALSE</span>, <span class="dt">trim_ws =</span> <span class="ot">TRUE</span>)
##############

## Trim RTs ####
data_trim &lt;-<span class="st"> </span>import <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(TrialProc <span class="op">==</span><span class="st"> &quot;real&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">RT =</span> <span class="kw">ifelse</span>(RT <span class="op">&lt;</span><span class="st"> </span><span class="dv">200</span>, <span class="ot">NA</span>, RT)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Subject, Condition) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">trim</span>(<span class="dt">variables =</span> <span class="st">&quot;RT&quot;</span>, <span class="dt">cutoff =</span> <span class="fl">3.5</span>, <span class="dt">replace =</span> <span class="st">&quot;cutoff&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>()
#################

## Calculate FlankerEffect on RT and Accuracy ####
data_flanker &lt;-<span class="st"> </span>data_trim <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">RT =</span> <span class="kw">ifelse</span>(Accuracy<span class="op">==</span><span class="dv">0</span>, <span class="ot">NA</span>, RT)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Subject, Condition) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">RT.mean =</span> <span class="kw">mean</span>(RT, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
            <span class="dt">Accuracy.mean =</span> <span class="kw">mean</span>(Accuracy, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">reshape_spread</span>(<span class="dt">variables =</span> <span class="st">&quot;Condition&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;RT.mean&quot;</span>, <span class="st">&quot;Accuracy.mean&quot;</span>), <span class="dt">id =</span> <span class="st">&quot;Subject&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">FlankerEffect_RT =</span> incongruent_RT.mean <span class="op">-</span><span class="st"> </span>congruent_RT.mean,
         <span class="dt">FlankerEffect_ACC =</span> incongruent_Accuracy.mean <span class="op">-</span><span class="st"> </span>congruent_Accuracy.mean)
##################################################

## Remove poor performing subjects ####
data_remove &lt;-<span class="st"> </span>data_flanker <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">center</span>(<span class="dt">variables =</span> <span class="kw">c</span>(<span class="st">&quot;congruent_Accuracy.mean&quot;</span>, 
                       <span class="st">&quot;incongruent_Accuracy.mean&quot;</span>, 
                       <span class="st">&quot;neutral_Accuracy.mean&quot;</span>), 
         <span class="dt">standardize =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(congruent_Accuracy.mean_z <span class="op">&lt;</span><span class="st"> </span>(<span class="op">-</span><span class="fl">3.5</span>) <span class="op">|</span>
<span class="st">           </span>incongruent_Accuracy.mean_z <span class="op">&lt;</span><span class="st"> </span>(<span class="op">-</span><span class="fl">3.5</span>) <span class="op">|</span><span class="st"> </span>
<span class="st">           </span>neutral_Accuracy.mean_z <span class="op">&lt;</span><span class="st"> </span>(<span class="op">-</span><span class="fl">3.5</span>))

data_flanker &lt;-<span class="st"> </span><span class="kw">remove_save</span>(data_flanker, data_remove, 
                            <span class="dt">output.dir =</span> <span class="kw">here</span>(output.dir, <span class="st">&quot;removed&quot;</span>), 
                            <span class="dt">output.file =</span> <span class="st">&quot;Flanker_removed.txt&quot;</span>)
#######################################

## Calculate Binned scores ####
data_binned &lt;-<span class="st"> </span>data_trim <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(RT), <span class="op">!</span>(Subject <span class="op">%in%</span><span class="st"> </span>data_remove<span class="op">$</span>Subject), Condition <span class="op">!=</span><span class="st"> &quot;neutral&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bin_score</span>(<span class="dt">rt.col =</span> <span class="st">&quot;RT&quot;</span>, <span class="dt">accuracy.col =</span> <span class="st">&quot;Accuracy&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;mean&quot;</span>,
            <span class="dt">condition.col =</span> <span class="st">&quot;Condition&quot;</span>, <span class="dt">baseline.condition =</span> <span class="st">&quot;congruent&quot;</span>, <span class="dt">id =</span> <span class="st">&quot;Subject&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">FlankerBin =</span> <span class="st">&quot;BinScore&quot;</span>)
###############################

## Merge dataframes and save ####
data_flanker &lt;-<span class="st"> </span><span class="kw">merge</span>(data_flanker, data_binned, <span class="dt">by =</span> <span class="st">&quot;Subject&quot;</span>, <span class="dt">all =</span> <span class="ot">TRUE</span>)
<span class="kw">write_delim</span>(data_flanker, <span class="dt">path =</span> <span class="kw">here</span>(output.dir, output.file), <span class="dt">delim =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">na =</span> <span class="st">&quot;&quot;</span>)
#################################

<span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())</code></pre></div>
<p>You can see that with the way the script is written it is not immediately obvious what data cleaning criteria we decided to use. The values are embedded in the middle of a lot of other code. If we want to make our script more transparent and easier to read we can set the data cleaning criteria as objects at the top of the script in the <strong>Set up</strong> section. This will, at the same time, make it easier to change the criteria if we decide to do so.</p>
<p>We can add the following code to the setup section</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Set Trimming criteria
rt.min &lt;-<span class="st"> </span><span class="dv">200</span>
rt.trim &lt;-<span class="st"> </span><span class="fl">3.5</span>
acc.criteria &lt;-<span class="st"> </span><span class="op">-</span><span class="fl">3.5</span></code></pre></div>
<ul>
<li><p><strong>rt.min</strong>: The minimum value on RT allowed. Set at 200 ms</p></li>
<li><p><strong>rt.trim</strong>: RT trimming criteria. Set at 3.5 SDs</p></li>
<li><p><strong>acc.criteria</strong>: Accuracy performance criteria for removing poor performing subjects. Set at -3.5 SDs</p></li>
</ul>
<p>Then we will need to replace the values in the script that correspond to these data cleaning steps.</p>
<p>Doing so results in a final script that looks like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Setup ####
<span class="kw">library</span>(here)
<span class="kw">library</span>(readr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(datawrangling)
<span class="kw">library</span>(englelab)

## Set import and output directories
directories &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">here</span>(<span class="st">&quot;directories.rds&quot;</span>))
import.dir &lt;-<span class="st"> </span>directories<span class="op">$</span>raw
output.dir &lt;-<span class="st"> </span>directories<span class="op">$</span>scored

## Set import and output files
import.file &lt;-<span class="st"> &quot;Flanker_raw.txt&quot;</span>
output.file &lt;-<span class="st"> &quot;Flanker_Scores.txt&quot;</span>

## Set Trimming criteria
rt.min &lt;-<span class="st"> </span><span class="dv">200</span>
rt.trim &lt;-<span class="st"> </span><span class="fl">3.5</span>
acc.criteria &lt;-<span class="st"> </span><span class="op">-</span><span class="fl">3.5</span>
#############

## Import ####
import &lt;-<span class="st"> </span><span class="kw">read_delim</span>(<span class="kw">here</span>(import.dir, <span class="st">&quot;Flanker_raw.txt&quot;</span>), <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">escape_double =</span> <span class="ot">FALSE</span>, <span class="dt">trim_ws =</span> <span class="ot">TRUE</span>)
##############

## Trim RTs ####
data_trim &lt;-<span class="st"> </span>import <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(TrialProc <span class="op">==</span><span class="st"> &quot;real&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">RT =</span> <span class="kw">ifelse</span>(RT <span class="op">&lt;</span><span class="st"> </span>rt.min, <span class="ot">NA</span>, RT)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Subject, Condition) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">trim</span>(<span class="dt">variables =</span> <span class="st">&quot;RT&quot;</span>, <span class="dt">cutoff =</span> rt.trim, <span class="dt">replace =</span> <span class="st">&quot;cutoff&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>()
#################

## Calculate FlankerEffect on RT and Accuracy ####
data_flanker &lt;-<span class="st"> </span>data_trim <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">RT =</span> <span class="kw">ifelse</span>(Accuracy<span class="op">==</span><span class="dv">0</span>, <span class="ot">NA</span>, RT)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Subject, Condition) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">RT.mean =</span> <span class="kw">mean</span>(RT, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
            <span class="dt">Accuracy.mean =</span> <span class="kw">mean</span>(Accuracy, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">reshape_spread</span>(<span class="dt">variables =</span> <span class="st">&quot;Condition&quot;</span>, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;RT.mean&quot;</span>, <span class="st">&quot;Accuracy.mean&quot;</span>), <span class="dt">id =</span> <span class="st">&quot;Subject&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">FlankerEffect_RT =</span> incongruent_RT.mean <span class="op">-</span><span class="st"> </span>congruent_RT.mean,
         <span class="dt">FlankerEffect_ACC =</span> incongruent_Accuracy.mean <span class="op">-</span><span class="st"> </span>congruent_Accuracy.mean)
##################################################

## Remove poor performing subjects ####
data_remove &lt;-<span class="st"> </span>data_flanker <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">center</span>(<span class="dt">variables =</span> <span class="kw">c</span>(<span class="st">&quot;congruent_Accuracy.mean&quot;</span>, 
                       <span class="st">&quot;incongruent_Accuracy.mean&quot;</span>, 
                       <span class="st">&quot;neutral_Accuracy.mean&quot;</span>), 
         <span class="dt">standardize =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(congruent_Accuracy.mean_z <span class="op">&lt;</span><span class="st"> </span>(acc.criteria) <span class="op">|</span>
<span class="st">           </span>incongruent_Accuracy.mean_z <span class="op">&lt;</span><span class="st"> </span>(acc.criteria) <span class="op">|</span><span class="st"> </span>
<span class="st">           </span>neutral_Accuracy.mean_z <span class="op">&lt;</span><span class="st"> </span>(acc.criteria))

data_flanker &lt;-<span class="st"> </span><span class="kw">remove_save</span>(data_flanker, data_remove, 
                            <span class="dt">output.dir =</span> <span class="kw">here</span>(output.dir, <span class="st">&quot;removed&quot;</span>), 
                            <span class="dt">output.file =</span> <span class="st">&quot;Flanker_removed.txt&quot;</span>)
#######################################

## Calculate Binned scores ####
data_binned &lt;-<span class="st"> </span>data_trim <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(RT), <span class="op">!</span>(Subject <span class="op">%in%</span><span class="st"> </span>data_remove<span class="op">$</span>Subject), Condition <span class="op">!=</span><span class="st"> &quot;neutral&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bin_score</span>(<span class="dt">rt.col =</span> <span class="st">&quot;RT&quot;</span>, <span class="dt">accuracy.col =</span> <span class="st">&quot;Accuracy&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;mean&quot;</span>,
            <span class="dt">condition.col =</span> <span class="st">&quot;Condition&quot;</span>, <span class="dt">baseline.condition =</span> <span class="st">&quot;congruent&quot;</span>, <span class="dt">id =</span> <span class="st">&quot;Subject&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">FlankerBin =</span> <span class="st">&quot;BinScore&quot;</span>)
###############################

## Merge dataframes and save ####
data_flanker &lt;-<span class="st"> </span><span class="kw">merge</span>(data_flanker, data_binned, <span class="dt">by =</span> <span class="st">&quot;Subject&quot;</span>, <span class="dt">all =</span> <span class="ot">TRUE</span>)
<span class="kw">write_delim</span>(data_flanker, <span class="dt">path =</span> <span class="kw">here</span>(output.dir, output.file), <span class="dt">delim =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">na =</span> <span class="st">&quot;&quot;</span>)
#################################

<span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())</code></pre></div>
</div>
</div>
<div id="source-in-masterscript" class="section level2">
<h2><span class="header-section-number">9.6</span> <code>source()</code> in Masterscript</h2>
<p>Now we can add lines of code in the manuscript to execute or <code>source()</code> the two scripts, “1_flanker_raw.R” and “2_flanker_score.R”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Setup ####
<span class="kw">library</span>(here)

## Set the directory tree
directories &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">scripts =</span> <span class="st">&quot;R Scripts&quot;</span>,
                    <span class="dt">data =</span> <span class="st">&quot;Data Files&quot;</span>,
                    <span class="dt">raw =</span> <span class="st">&quot;Data Files/Raw Data&quot;</span>,
                    <span class="dt">messy =</span> <span class="st">&quot;Data Files/Raw Data/E-Merge&quot;</span>,
                    <span class="dt">scored =</span> <span class="st">&quot;Data Files/Scored Data&quot;</span>,
                    <span class="dt">results =</span> <span class="st">&quot;Results&quot;</span>)

<span class="kw">saveRDS</span>(directories, <span class="kw">here</span>(<span class="st">&quot;directories.rds&quot;</span>))
#############

## &quot;messy&quot; to &quot;tidy&quot; raw data
<span class="kw">source</span>(<span class="kw">here</span>(<span class="st">&quot;R Scripts&quot;</span>, <span class="st">&quot;1_flanker_raw.R&quot;</span>), <span class="dt">echo=</span><span class="ot">TRUE</span>)

## &quot;tidy&quot; to scored data
<span class="kw">source</span>(<span class="kw">here</span>(<span class="st">&quot;R Scripts&quot;</span>, <span class="st">&quot;2_flanker_score.R&quot;</span>), <span class="dt">echo=</span><span class="ot">TRUE</span>)

<span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())</code></pre></div>
<p>In using the mastersript you can either execute the entire script by clicking on “Source” or you can run one line of code at a time. For instance, maybe you have already created the “tidy” raw data files. You can open up the masterscript and simply execute the line of code that sources the script to score the task data. This gives you flexibility in controlling your scripts. This becomes more useful when you have a lot of scripts to run (we only have two in this case so it is not too big of a deal).</p>
<hr />
<hr />
<p><strong>Now onto the really fun stuff, data visualization and statistical analysis!</strong></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="organization-and-good-practices.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="analyzing-data-in-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper", "github"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

</body>

</html>
