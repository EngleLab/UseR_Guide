<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>6 Common Data Manipulations | EngleLab: useRguide</title>
<meta name="author" content="Jason Tsukahara">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.2.9000/tabs.js"></script><script src="libs/bs3compat-0.2.2.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">EngleLab: useRguide</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome to the EngleLab useRguide</a></li>
<li class="book-part">Getting Started in R</li>
<li><a class="" href="installation.html"><span class="header-section-number">1</span> Installation</a></li>
<li><a class="" href="basic-r.html"><span class="header-section-number">2</span> Basic R</a></li>
<li><a class="" href="intermediate-r.html"><span class="header-section-number">3</span> Intermediate R</a></li>
<li class="book-part">Working with Data</li>
<li><a class="" href="working-with-data-overview.html">Working with Data: Overview</a></li>
<li><a class="" href="importing-and-outputing-data.html"><span class="header-section-number">4</span> Importing and Outputing Data</a></li>
<li><a class="" href="data-manipulation-using-dplyr.html"><span class="header-section-number">5</span> Data Manipulation using dplyr</a></li>
<li><a class="active" href="common-data-manipulations.html"><span class="header-section-number">6</span> Common Data Manipulations</a></li>
<li class="book-part">Reproducible Workflows</li>
<li><a class="" href="reproducible-workflows-overview.html">Reproducible Workflows: Overview</a></li>
<li><a class="" href="project-organization.html"><span class="header-section-number">7</span> Project Organization</a></li>
<li><a class="" href="reproducible-practices.html"><span class="header-section-number">8</span> Reproducible Practices</a></li>
<li><a class="" href="r-script-templates.html"><span class="header-section-number">9</span> R Script Templates</a></li>
<li class="book-part">Create R Scripts</li>
<li><a class="" href="create-r-scripts-overview.html">Create R Scripts: Overview</a></li>
<li><a class="" href="data-preparation-setup.html"><span class="header-section-number">10</span> Data Preparation: Setup</a></li>
<li><a class="" href="data-preparation-messy-to-tidy.html"><span class="header-section-number">11</span> Data Preparation: Messy to Tidy</a></li>
<li><a class="" href="data-analysis-setup.html"><span class="header-section-number">12</span> Data Analysis: Setup</a></li>
<li><a class="" href="data-analysis-tidy-to-scored.html"><span class="header-section-number">13</span> Data Analysis: Tidy to Scored</a></li>
<li><a class="" href="data-analysis-single-merged-file.html"><span class="header-section-number">14</span> Data Analysis: Single Merged File</a></li>
<li class="book-part">Data Visualization</li>
<li><a class="" href="data-visualization-overview.html">Data Visualization: Overview</a></li>
<li><a class="" href="fundamentals-of-data-visualization.html"><span class="header-section-number">15</span> Fundamentals of Data Visualization</a></li>
<li><a class="" href="introduction-to-ggplot2.html"><span class="header-section-number">16</span> Introduction to ggplot2</a></li>
<li><a class="" href="scatterplots.html"><span class="header-section-number">17</span> Scatterplots</a></li>
<li><a class="" href="plotting-means.html"><span class="header-section-number">18</span> Plotting Means</a></li>
<li><a class="" href="univariate-plots.html"><span class="header-section-number">19</span> Univariate Plots</a></li>
<li class="book-part">Statistical Analysis</li>
<li><a class="" href="statistical-analysis-overview.html">Statistical Analysis: Overview</a></li>
<li><a class="" href="statistics-in-r.html"><span class="header-section-number">20</span> Statistics in R</a></li>
<li><a class="" href="structural-equation-modelling.html"><span class="header-section-number">21</span> Structural Equation Modelling</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="common-data-manipulations" class="section level1">
<h1>
<span class="header-section-number">6</span> Common Data Manipulations<a class="anchor" aria-label="anchor" href="#common-data-manipulations"><i class="fas fa-link"></i></a>
</h1>
<p><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous"></p>
<p>In R, the term data wrangling is often times used to refer to performing data manipulation and transformations. Some of the functions you will learn about in this Chapter come from the <a href="https://dr-jt.github.io/datawrangling/" target="_blank"><strong>datawrangling</strong> package</a> I developed.</p>
<div class="inline-figure"><img src="images/datawrangling_logo.png" width="125" style="display: block; margin: auto;"></div>
<p>There are certain data transformations we use on a regular basis that would require several steps and lines of code to do. <code>datawrangling</code> allows you to perform these transformation in a single line of code.</p>
<p>I am hosting the <code>datawrangling</code> package on GitHub. To download packages on GitHub you first need to download the <code>devtools</code> package.</p>
<div class="sourceCode" id="cb158"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)
</pre></div>
<p>Now install the <code>datawrangling</code> package:</p>
<div class="sourceCode" id="cb159"><pre class="downlit">
<span class="kw">devtools</span>::<span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"dr-JT/datawrangling"</span>)
</pre></div>
<hr>
<div style="text-align: center; font-size: 1.25em">
<p><i class="fas fa-save" style="font-size: 3em"></i></p>
<p>Save a new R script file as <code>6_transform.R</code></p>
</div>
<hr>
<p>For this Chapter, let’s create a data frame to use as an example for common data manipulations using <code>datawrangling</code>. Don’t worry about what this code means for now, just copy it into your script and run it.</p>
<div class="sourceCode" id="cb160"><pre class="downlit">
<span class="kw">import</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(ID = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span><span class="op">:</span><span class="fl">100</span>), 
                     Group = <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>), <span class="fl">50</span>),
                     Score1 = <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">100</span>, mean = <span class="fl">2</span>, sd = <span class="fl">.8</span>), 
                     Score2 = <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">100</span>, mean = <span class="fl">7</span>, sd = <span class="fl">1.1</span>), 
                     Score3 = <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">100</span>, mean = <span class="fl">10</span>, sd = <span class="fl">1.8</span>), 
                     Score4 = <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">100</span>, mean = <span class="fl">20</span>, sd = <span class="fl">2.3</span>))

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">import</span>)
<span class="co">##   ID Group   Score1   Score2    Score3   Score4</span>
<span class="co">## 1  1     1 2.108583 6.909211  9.569533 21.10629</span>
<span class="co">## 2  2     2 1.729564 6.348592  9.488073 17.62381</span>
<span class="co">## 3  3     1 1.168912 8.357614 12.028537 21.40660</span>
<span class="co">## 4  4     2 1.612341 5.694310 11.830850 22.75000</span>
<span class="co">## 5  5     1 3.006348 6.261088 14.137273 20.82632</span>
<span class="co">## 6  6     2 2.751853 6.430017 12.013493 21.24679</span>
</pre></div>
<hr>
<div id="descriptive-statistics" class="section level2">
<h2>
<span class="header-section-number">6.1</span> Descriptive Statistics<a class="anchor" aria-label="anchor" href="#descriptive-statistics"><i class="fas fa-link"></i></a>
</h2>
<p>First you should know how to compute some basic descriptive statistics.</p>
<p>Basic descriptive statistics include mean, median, standard deviation, max, min, skew, kurtosis, etc…</p>
<p>The functions to calculate these are pretty straightforward:</p>
<p><em>Base R</em></p>
<ul>
<li><p><strong>maximum</strong>: <code><a href="https://rdrr.io/r/base/Extremes.html">max()</a></code></p></li>
<li><p><strong>minimum</strong>: <code><a href="https://rdrr.io/r/base/Extremes.html">min()</a></code></p></li>
<li><p><strong>count</strong>:<code><a href="https://dplyr.tidyverse.org/reference/context.html">n()</a></code></p></li>
<li><p><strong>mean</strong>: <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code></p></li>
<li><p><strong>median</strong>: <code><a href="https://rdrr.io/r/stats/median.html">median()</a></code></p></li>
<li><p><strong>standard deviation</strong>: <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code></p></li>
<li><p><strong>variance</strong>: <code><a href="https://rdrr.io/r/stats/cor.html">var()</a></code></p></li>
<li>
<p><strong>quantiles (percentiles)</strong>: <code><a href="https://rdrr.io/r/stats/quantile.html">quantile()</a></code></p>
<p>specify the percentiles with the argument <code>probs =</code> (default is c(0, .25, .5, .75, 1))</p>
</li>
</ul>
<p><strong>From the <em>e1071</em> package</strong></p>
<ul>
<li><p><strong>skewness</strong>: <code>skewness(variable, na.rm = TRUE, type = 2)</code></p></li>
<li><p><strong>kurtosis</strong>: <code>kurtosis(variable, na.rm = TRUE, type = 2)</code></p></li>
</ul>
<p>For all of these you need to specify <code>na.rm = TRUE</code> if the variable column has missing data. It is best to just always set <code>na.rm = TRUE</code>. For example,</p>
<div class="sourceCode" id="cb161"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">variable</span>, na.rm = <span class="fl">TRUE</span>)
</pre></div>
<p>To calculate the overall mean on <code>Score1</code> would look like</p>
<div class="sourceCode" id="cb162"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)

<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">import</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(Score1.mean = <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">Score1</span>, na.rm = <span class="fl">TRUE</span>))
</pre></div>
</div>
<div id="centering-and-standardizing-variables" class="section level2">
<h2>
<span class="header-section-number">6.2</span> Centering and Standardizing Variables<a class="anchor" aria-label="anchor" href="#centering-and-standardizing-variables"><i class="fas fa-link"></i></a>
</h2>
<p>The function <code><a href="https://dr-jt.github.io/datawrangling//reference/center.html">datawrangling::center()</a></code> will create either unstandardized or standardized (z-scored) centered variables. The list of arguments that can be passed onto the function are:</p>
<ul>
<li><p><strong>x</strong>: data frame</p></li>
<li><p><strong>variables</strong>: c() of columns to center</p></li>
<li><p><strong>standardize</strong>: Logical. Do you want to calculate zscores? (Default = FALSE)</p></li>
</ul>
<p>Example:</p>
<div class="sourceCode" id="cb163"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/dr-JT/datawrangling">datawrangling</a></span>)

<span class="kw">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dr-jt.github.io/datawrangling//reference/center.html">center</a></span>(<span class="kw">import</span>, 
               variables = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Score1"</span>, <span class="st">"Score2"</span>, <span class="st">"Score3"</span>, <span class="st">"Score4"</span>), 
               standardize = <span class="fl">TRUE</span>)
</pre></div>
<p>View the data frame <code>data</code>. You will notice that there are now 4 additional columns: <code>Score1_z</code>, <code>Score2_z</code>, <code>Score3_z</code>, and <code>Score4_z</code>.</p>
<p>If you choose to to calculate centered (unstandardized) scores, then <code>standardize = FALSE</code>. And it will create variables with the suffix <code>_c</code>.</p>
<p>This can be combined with a <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> to calculate standardized values within each group separately.</p>
<div class="sourceCode" id="cb164"><pre class="downlit">
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">import</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">Group</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dr-jt.github.io/datawrangling//reference/center.html">center</a></span>(variables = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Score1"</span>, <span class="st">"Score2"</span>, <span class="st">"Score3"</span>, <span class="st">"Score4"</span>), 
         standardize = <span class="fl">TRUE</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>()
</pre></div>
</div>
<div id="trimming" class="section level2">
<h2>
<span class="header-section-number">6.3</span> Trimming<a class="anchor" aria-label="anchor" href="#trimming"><i class="fas fa-link"></i></a>
</h2>
<p>The function <code><a href="https://dr-jt.github.io/datawrangling//reference/trim.html">datawrangling::trim()</a></code> will replace outlier scores that exceed a certain z-score cutoff.</p>
<p>There are several options for how to replace the outlier scores. Replace with</p>
<ul>
<li><p>“NA” (missing value)</p></li>
<li><p>“cutoff” (the z-score cutoff value, e.g. 3.5 SDs)</p></li>
<li><p>“mean”</p></li>
<li><p>“median”</p></li>
</ul>
<p>The arguments that can be specified are:</p>
<ul>
<li><p><strong>x</strong>: data frame</p></li>
<li><p><strong>variables</strong>: c() of variables to be trimmed. option to set <code>variables = "all"</code> to trim all variables in a data frame. But then must specify <code>id =</code></p></li>
<li><p><strong>cutoff</strong>: z-score cutoff to use for trimming (default: 3.5)</p></li>
<li><p><strong>replace</strong>: What value should the outlier values be replaced with. (default: replace = “NA”)</p></li>
<li><p><strong>id</strong>: Column name that contains subject IDs. **ONLY needs to be used if <code>variables = "all"</code></p></li>
</ul>
<p>Example:</p>
<div class="sourceCode" id="cb165"><pre class="downlit">
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">import</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dr-jt.github.io/datawrangling//reference/trim.html">trim</a></span>(variables = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Score1"</span>, <span class="st">"Score2"</span>, <span class="st">"Score3"</span>, <span class="st">"Score4"</span>), 
       cutoff = <span class="fl">3.5</span>, 
       replace = <span class="st">"NA"</span>, id = <span class="st">"ID"</span>)
</pre></div>
<p>Notice how you don’t even need to <code><a href="https://dr-jt.github.io/datawrangling//reference/center.html">center()</a></code> the variables first. The centering is being done inside of <code><a href="https://dr-jt.github.io/datawrangling//reference/trim.html">trim()</a></code>. You can evaluate outliers and replace with different values (<code>replace =</code>) all in one function and one line of code.</p>
</div>
<div id="composites" class="section level2">
<h2>
<span class="header-section-number">6.4</span> Composites<a class="anchor" aria-label="anchor" href="#composites"><i class="fas fa-link"></i></a>
</h2>
<p>The <code><a href="https://dr-jt.github.io/datawrangling//reference/composite.html">datawrangling::composite()</a></code> function allows you to easily create a composite score from multiple variables and also specify a certain criteria for how many missing values are allowed.</p>
<div class="sourceCode" id="cb166"><pre class="downlit">
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">import</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dr-jt.github.io/datawrangling//reference/composite.html">composite</a></span>(variables = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Score1"</span>, <span class="st">"Score2"</span>, <span class="st">"Score3"</span>), 
            name = <span class="st">"Score_comp"</span>,
            type = <span class="st">"mean"</span>,
            standardize = <span class="fl">TRUE</span>,
            missing.allowed = <span class="fl">1</span>)
</pre></div>
<p>The function <code><a href="https://dr-jt.github.io/datawrangling//reference/composite.html">composite()</a></code> will create composite scores out of specified columns. Right now you can only create “mean” composite scores. In the future I plan on adding “sum” and “factor score” composite types.</p>
<p>Here is a list of the arguments you can specify:</p>
<ul>
<li><p><strong>x</strong>: data frame</p></li>
<li><p><strong>variables</strong>: c() of columns to create the composite from</p></li>
<li><p><strong>name</strong>: Name of the new composite variable to be created</p></li>
<li><p><strong>type</strong>: What type of composite should be calculated?, i.e. mean or sum. (Default = “mean”).</p></li>
<li><p><strong>standardize</strong>: Logical. Do you want to calculate the composite based on standardized (z-score) values? (Default = TRUE)</p></li>
<li><p><strong>missing.allowed</strong>: Criteria for the number of variables that can having missing values and still calculate a composite for that subject</p></li>
</ul>
<hr>
<p>The remaining functions do not come from the <code>datawrangling</code> package but you may find them useful nonetheless.</p>
<hr>
</div>
<div id="scale-transformations" class="section level2">
<h2>
<span class="header-section-number">6.5</span> Scale Transformations<a class="anchor" aria-label="anchor" href="#scale-transformations"><i class="fas fa-link"></i></a>
</h2>
<div id="polynomial" class="section level3">
<h3>
<span class="header-section-number">6.5.1</span> polynomial<a class="anchor" aria-label="anchor" href="#polynomial"><i class="fas fa-link"></i></a>
</h3>
<p>You can create orthogonal polynomials of variables using the <code><a href="https://rdrr.io/r/stats/poly.html">poly()</a></code> function and specify the degree of polynomial to go up to with <code>degree =</code></p>
<div class="sourceCode" id="cb167"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span>(<span class="kw">import</span><span class="op">$</span><span class="kw">Score1</span>, degree = <span class="fl">3</span>)
</pre></div>
<p>You can see it creates up to three degrees of polynomials on the Score1 variable. The first degree is a linear, second is a quadratic, and third is cubic. Let’s say we want to create three new columns with each of these three polynomials. To do so we need to individually access each vector such as</p>
<div class="sourceCode" id="cb168"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span>(<span class="kw">import</span><span class="op">$</span><span class="kw">Score1</span>, degree = <span class="fl">3</span>)[,<span class="fl">1</span>]
</pre></div>
<div class="sourceCode" id="cb169"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)

<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">import</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(Score1.linear = <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span>(<span class="kw">Score1</span>, degree = <span class="fl">3</span>)[ , <span class="fl">1</span>],
         Score1.quadratic = <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span>(<span class="kw">Score1</span>, degree = <span class="fl">3</span>)[ , <span class="fl">2</span>],
         Score1.cubic = <span class="fu"><a href="https://rdrr.io/r/stats/poly.html">poly</a></span>(<span class="kw">Score1</span>, degree = <span class="fl">3</span>)[ , <span class="fl">3</span>])
</pre></div>
<p>Here is plot to show you visually what happened</p>
<div class="inline-figure"><img src="EngleLab-useRguide_files/figure-html/unnamed-chunk-177-1.png" width="672"></div>
</div>
</div>
<div id="custom-transformations" class="section level2">
<h2>
<span class="header-section-number">6.6</span> Custom Transformations<a class="anchor" aria-label="anchor" href="#custom-transformations"><i class="fas fa-link"></i></a>
</h2>
<p>In general, with <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> you can specify any custom transformation you want to do on a variable. For instance, if you want to subtract each score by <code>5</code>, and divide by <code>10</code> then you can do it! I don’t know why you would ever want to do that, but you can.</p>
<div class="sourceCode" id="cb170"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)

<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">import</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(Score_crazy = (<span class="kw">Score1</span> <span class="op">-</span> <span class="fl">5</span>) <span class="op">/</span> <span class="fl">10</span>)
</pre></div>
<p>Or take the sum of <code>Score1</code> and <code>Score2</code> and divide by the difference between <code>Score3</code> and <code>Score4</code>.</p>
<div class="sourceCode" id="cb171"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)

<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">import</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(Score_crazy = (<span class="kw">Score1</span> <span class="op">+</span> <span class="kw">Score2</span>) <span class="op">/</span> (<span class="kw">Score3</span> <span class="op">-</span> <span class="kw">Score4</span>))
</pre></div>
</div>
<div id="row-wise-computations" class="section level2">
<h2>
<span class="header-section-number">6.7</span> Row-wise Computations<a class="anchor" aria-label="anchor" href="#row-wise-computations"><i class="fas fa-link"></i></a>
</h2>
<p>The examples for <em>Custom Transformations</em> allowed you to calculate a new variable across multiple columns and within a row. For those examples that was no problem. However, sometimes you want to do more complicated computations or use certain functions such as <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> to calculate the average score across multiple columns. The problem is that <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> works across rows and only within one column.</p>
<p>How can we get around that? In the near future (May 15th, 2020), <code>dplyr</code> version 1.0.0 will be released and includes a new function <code><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise()</a></code> for this very purpose. Until then we can use a base R function <code><a href="https://rdrr.io/r/base/colSums.html">rowMeans()</a></code> and <code><a href="https://rdrr.io/r/base/colSums.html">rowSums()</a></code>.</p>
<div class="sourceCode" id="cb172"><pre class="downlit">
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">import</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(score_mean = <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="kw">data</span>[ ,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Score1"</span>, <span class="st">"Score2"</span>, <span class="st">"Score3"</span>, <span class="st">"Score4"</span>)]))
</pre></div>
</div>
<div id="remove-subjects-with-too-many-missing-values" class="section level2">
<h2>
<span class="header-section-number">6.8</span> Remove subjects with too many missing values<a class="anchor" aria-label="anchor" href="#remove-subjects-with-too-many-missing-values"><i class="fas fa-link"></i></a>
</h2>
<p>In our lab, when doing latent variable analyses we often times like to remove subjects that have too many missing values on any given latent factor. For instance, we often times have three task indicators for a latent factor. If a subject has missing values for 2 out of 3 of those task indicators (therefore only has one indicator) then we will remove them. But how do go about doing this in R?</p>
<p>First let’s modify the <code>import</code> data frame to be more suited for this by adding some missing values</p>
<div class="sourceCode" id="cb173"><pre class="downlit">
<span class="kw">import</span> <span class="op">&lt;-</span> <span class="kw">import</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(Score1 = <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">Score1</span> <span class="op">&lt;</span> <span class="fl">1</span>, <span class="fl">NA</span>, <span class="kw">Score1</span>),
         Score2 = <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">Score2</span> <span class="op">&lt;</span> <span class="fl">6</span>, <span class="fl">NA</span>, <span class="kw">Score2</span>),
         Score3 = <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">Score3</span> <span class="op">&lt;</span> <span class="fl">9</span>, <span class="fl">NA</span>, <span class="kw">Score3</span>),
         Score4 = <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">Score4</span> <span class="op">&lt;</span> <span class="fl">16</span>, <span class="fl">NA</span>, <span class="kw">Score4</span>),
         Score5 = <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">100</span>, mean = <span class="fl">13</span>, sd = <span class="fl">5</span>))
</pre></div>
<p>View the data frame and notice how there are quite a few missing values. Some subjects have missing values on multiple columns. The steps to get rid of subjects with too many missing values on a select number of columns are:</p>
<ol style="list-style-type: decimal">
<li><p>Create a column with a count of how many columns has missing values for each subject (a row-wise computation)</p></li>
<li><p>Filter subjects that have a certain criteria of missing values</p></li>
</ol>
<p>Just to get a sense of how these steps work we can do this in multiple ways.</p>
<p>First let’s calculate the total number of missing values across all columns and remove subjects that have missing values on 3 of the columns.</p>
<div class="sourceCode" id="cb174"><pre class="downlit">
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">import</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(missing.total = 
           <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw">import</span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Score1"</span>, <span class="st">"Score2"</span>, <span class="st">"Score3"</span>, 
                                   <span class="st">"Score4"</span>, <span class="st">"Score5"</span>)])))
</pre></div>
<p>View the data frame and notice that some subjects have 0, 1, 2, or 3 columns with missing values.</p>
<div class="sourceCode" id="cb175"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw">data</span><span class="op">$</span><span class="kw">missing.total</span>)
</pre></div>
<pre><code>## [1] 0 1 2 3</code></pre>
<p>Now let’s remove those with 3 or more columns missing. What we will actually specify is to keep those with less than 3 missing columns</p>
<div class="sourceCode" id="cb177"><pre class="downlit">
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">import</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(missing.total = 
           <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw">import</span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Score1"</span>, <span class="st">"Score2"</span>, <span class="st">"Score3"</span>, 
                                   <span class="st">"Score4"</span>, <span class="st">"Score5"</span>)]))) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">missing.total</span> <span class="op">&lt;</span> <span class="fl">3</span>)
</pre></div>
<p>Compare the number of rows between <code>import</code> and <code>data</code></p>
<div class="sourceCode" id="cb178"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">import</span>)
</pre></div>
<pre><code>## [1] 100</code></pre>
<div class="sourceCode" id="cb180"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">data</span>)
</pre></div>
<pre><code>## [1] 98</code></pre>
<p>Two subjects were removed.</p>
<p>Now let’s calculate the total number of missing values for two different latent factors. Let’s say latent factor 1, <code>latent1</code>, includes the column indicators <code>Score1</code> and <code>Score2</code>, whereas latent factor 2, <code>latent2</code>, includes the column indicators <code>Score3</code>, <code>Score4</code>, and <code>Score5</code>. Let’s remove subjects that have missing values on 1 out of the 2 columns for <code>latent1</code> and 2 out of 3 for <code>latent2</code>.</p>
<div class="sourceCode" id="cb182"><pre class="downlit">
<span class="kw">data</span> <span class="op">&lt;-</span> <span class="kw">import</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(missing.1 = <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw">import</span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Score1"</span>, <span class="st">"Score2"</span>)])),
         missing.2 = 
           <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw">import</span>[,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Score3"</span>, <span class="st">"Score4"</span>, <span class="st">"Score5"</span>)]))) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">missing.1</span> <span class="op">&lt;</span> <span class="fl">1</span>, <span class="kw">missing.2</span> <span class="op">&lt;</span> <span class="fl">2</span>)
</pre></div>
<p>View and evaluate <code>data</code>. Also compare the number of rows</p>
<div class="sourceCode" id="cb183"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">import</span>)
</pre></div>
<pre><code>## [1] 100</code></pre>
<div class="sourceCode" id="cb185"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">data</span>)
</pre></div>
<pre><code>## [1] 70</code></pre>
<p>There are now only 70 subjects, we removed 30 total subjects! Yikes.</p>
<hr>
</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="data-manipulation-using-dplyr.html"><span class="header-section-number">5</span> Data Manipulation using dplyr</a></div>
<div class="next"><a href="reproducible-workflows-overview.html">Reproducible Workflows: Overview</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#common-data-manipulations"><span class="header-section-number">6</span> Common Data Manipulations</a></li>
<li><a class="nav-link" href="#descriptive-statistics"><span class="header-section-number">6.1</span> Descriptive Statistics</a></li>
<li><a class="nav-link" href="#centering-and-standardizing-variables"><span class="header-section-number">6.2</span> Centering and Standardizing Variables</a></li>
<li><a class="nav-link" href="#trimming"><span class="header-section-number">6.3</span> Trimming</a></li>
<li><a class="nav-link" href="#composites"><span class="header-section-number">6.4</span> Composites</a></li>
<li>
<a class="nav-link" href="#scale-transformations"><span class="header-section-number">6.5</span> Scale Transformations</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#polynomial"><span class="header-section-number">6.5.1</span> polynomial</a></li></ul>
</li>
<li><a class="nav-link" href="#custom-transformations"><span class="header-section-number">6.6</span> Custom Transformations</a></li>
<li><a class="nav-link" href="#row-wise-computations"><span class="header-section-number">6.7</span> Row-wise Computations</a></li>
<li><a class="nav-link" href="#remove-subjects-with-too-many-missing-values"><span class="header-section-number">6.8</span> Remove subjects with too many missing values</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>EngleLab: useRguide</strong>" was written by Jason Tsukahara. It was last built on 2020-11-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
