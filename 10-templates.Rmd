# My Templates

## masterscript Template

A masterscript file is most useful when you have many R Scripts you want to run, or you want to run only a subset of the R Scripts. The masterscript will give you flexibility to control which R Scripts you are running without having to open each script file.

One issue that comes up, however, is how to use the same relative file paths across all your R scripts. The most basic solution is to set the relative file paths for import and output directories at the top of every script as such

```{r eval=FALSE}
import.dir <- "data/import"
outpud.dir <- "data/output"
```

Generally speaking, this is actually adequate. However, you may run into issues if you change the folder organization, or if you want to share your data and scripts with someone and they create a different folder organization. Every single R Script will have to be changed to reflect the different organization. This can also become an issue when archiving data. 

A solution I came up with aims to maximize reproducibility and ease of use. 

### directories.rds

The solution is to save an R object that contains a list of the relevant directories that matches your folder organization, relative to the working directory. This list object will then be saved to a file in the working directory as `"directories.rds"` with the following command

```{r eval=FALSE}
## Specify the directory tree
directories <- list(scripts = "R Scripts",
                    raw = "Raw Data",
                    scored = "Scored Data")

saveRDS(directories, here("directories.rds"))
```

Now at the top of each R Script you can include a line to load the `"directories.rds"` file as such

```{r eval=FALSE}
directories <- readRDS(here("directories.rds"))
```

In the R Script files, you can then reference a directory as such `direcotries$raw`

Now if you change the folder organization, you only have to edit the `directories` list object in the masterscript.

********

Here is an example mastercript that corresponds to the R Script you created in Chapters 7 and 8.

```{r eval=FALSE}
## Setup ####
## Load Packages
library(here)

## Specify the directory tree
directories <- list(scripts = "R Scripts",
                    raw = "Raw Data",
                    scored = "Scored Data")

saveRDS(directories, here("directories.rds"))
#############

############################
#------ Data Scoring ------#
############################

## Score task data from raw data files ####
source(here("R Scripts", "flanker_score.R"), echo=TRUE)
###########################################
```

********

Then the R script `flanker_score.R`, corresponding to the script you created in Chapter 8, could look like this

```{r eval=FALSE}
## Set up ####
## Load required packages
library(readr)
library(dplyr)
library(here)

## Set import and output directories
directories <- readRDS(here("directories.rds"))
import.dir <- directories$raw
output.dir <- directories$scored
##############

task <- "Flanker"

## Import data
import.file <- paste(task, "raw.txt", sep = "_")
import <- read_delim(here(import.dir, import.file), "\t", escape_double = FALSE, trim_ws = TRUE)

## Do Stuff
data <- import %>%
  rename(Accuracy = ACC) %>%
  filter(TrialProc == "real") %>%
  select(Subject, Condition, RT, Trial, ACC = Accuracy) %>%
  group_by(Subject, Condition) %>%
  mutate(RT = ifelse(RT<200, NA, RT),
         grandRT = mean(RT, na.rm=TRUE),
         RTdiff = RT - grandRT) %>%
  summarise(RT.mean = mean(RT, na.rm = TRUE),
            RT.sd = sd(RT, na.rm = TRUE)) %>%
  ungroup()

## Save data
output.file <- paste(task, "Scored.txt", sep = "_")
write_delim(data, path = here(output.dir, output.file), delim = "\t", na = "")
```

Feel free to use the exact same template layout. Just copy and paste. In fact, almost every line can be copy and pasted to fit other R scripts you might create. The only thing that you might need to modify is `task <- ` and `data <- import %>%` lines.


********

**Let's move onto doing SEM in R!**
